import{c as A,b as ee,u as te,d as ae,r as p,i as se,a as f,j as e,S as C,f as x}from"./index-B6hPo9fH.js";import{u as L}from"./useMutation-C_3TpXjp.js";import{L as ie}from"./Layout-BTVfT1Q4.js";import{C as k,a as F,b as re,c as ne}from"./card-Cl1MO1GN.js";import{B as l}from"./button-DdYfvWb9.js";import{B as T}from"./badge-Dn4EaI7W.js";import{I as c}from"./input-vnQcFn7U.js";import{L as r}from"./label-B38SsxLd.js";import{T as D}from"./textarea-Cc28xWq-.js";import{S as ce,a as de,b as le,c as oe,d as E}from"./select-_UnfLIee.js";import{D as M,d as me,a as q,b as V,c as $}from"./dialog-D_lwzFP4.js";import{u as ue}from"./useTranslation-O3_Fa0eH.js";import{P as K}from"./plus-DWkselk7.js";import{S as pe}from"./shield-DVigj7cn.js";import{C as xe}from"./chart-column-CdgtT9kY.js";import{T as he}from"./trash-2-DycntUct.js";import{P as ge}from"./package-Rp_T8fxM.js";import"./ThemeToggle-Cd9vwdUm.js";import"./index-Dt-oTuiC.js";import"./shopping-cart-DT7LSJeM.js";import"./triangle-alert-DGpOeCBb.js";import"./index-BdQq_4o_.js";import"./index-D8nDhomm.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],be=A("square-pen",ye);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ve=A("trending-down",je);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],fe=A("trending-up",Ne);function Re(){const{t:Ce}=ue(),[,w]=ee(),g=te(),{toast:u}=ae(),[Y,y]=p.useState(!1),[B,b]=p.useState(!1),[S,O]=p.useState(null),[a,d]=p.useState({type:"sell",currency:"USD",pricePerUnit:"",minLimit:"",maxLimit:"",availableAmount:"",accountType:"",terms:""}),[i,o]=p.useState({pricePerUnit:"",minLimit:"",maxLimit:"",availableAmount:"",terms:"",isActive:!0}),h=(t,n)=>{const s=parseFloat(t)||0,m=parseFloat(n)||0;return s>0&&m>0?String(Math.floor(s*m)):""},I=t=>{if(t===""){d({...a,pricePerUnit:"",maxLimit:""});return}if(!/^\d+(\.\d{0,8})?$/.test(t))return;if(parseFloat(t)>0){const s=h(t,a.availableAmount);d({...a,pricePerUnit:t,maxLimit:s})}},_=t=>{if(parseFloat(t)<0)return;const s=h(a.pricePerUnit,t);d({...a,availableAmount:t,maxLimit:s})},Q=t=>{if(t===""){d({...a,minLimit:""});return}if(!/^\d+(\.\d{0,8})?$/.test(t))return;parseFloat(t)>=.5&&d({...a,minLimit:t})};if(!se())return w("/auth"),null;const{data:H}=f({queryKey:["maintenanceSettings"],queryFn:async()=>(await fetch("/api/maintenance/status")).json()}),{data:R,isLoading:z}=f({queryKey:["kycStatus"],queryFn:async()=>(await x("/api/kyc/status")).json()}),P=R?.status==="approved",U=H?.kycRequired===!0,{data:j,isLoading:J}=f({queryKey:["vendorOffers"],queryFn:async()=>(await x("/api/vendor/offers")).json()}),v=L({mutationFn:async t=>{if(parseFloat(t.pricePerUnit)<=0||parseFloat(t.availableAmount)<=0||parseFloat(t.minLimit)<0)throw new Error("Price, accounts, and min limit must be positive values");if(!t.accountType.trim())throw new Error("Account type is required");const n={type:t.type,currency:"USD",pricePerUnit:t.pricePerUnit,minLimit:t.minLimit,maxLimit:t.maxLimit,availableAmount:t.availableAmount,paymentMethods:[t.accountType.trim()],terms:t.terms},s=await x("/api/vendor/offers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok){const m=await s.json();throw new Error(m.message||"Failed to create offer")}return s.json()},onSuccess:()=>{g.invalidateQueries({queryKey:["vendorOffers"]}),y(!1),u({title:"Offer Created",description:"Your offer is now live on the marketplace"}),d({type:"sell",currency:"USD",pricePerUnit:"",minLimit:"",maxLimit:"",availableAmount:"",accountType:"",terms:""})},onError:t=>{u({variant:"destructive",title:"Failed to Create Offer",description:t.message})}}),X=L({mutationFn:async t=>{if(!(await x(`/api/vendor/offers/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete offer")},onSuccess:()=>{g.invalidateQueries({queryKey:["vendorOffers"]}),u({title:"Offer Deleted",description:"Your ad has been removed"})}}),N=L({mutationFn:async({offerId:t,updates:n})=>{const s=await x(`/api/vendor/offers/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok){const m=await s.json();throw new Error(m.message||"Failed to update offer")}return s.json()},onSuccess:()=>{g.invalidateQueries({queryKey:["vendorOffers"]}),b(!1),O(null),u({title:"Offer Updated",description:"Your ad has been updated successfully"})},onError:t=>{u({variant:"destructive",title:"Failed to Update",description:t.message})}}),W=t=>{O(t),o({pricePerUnit:t.pricePerUnit,minLimit:t.minLimit,maxLimit:t.maxLimit,availableAmount:t.availableAmount,terms:t.terms||"",isActive:t.isActive}),b(!0)},G=t=>{if(parseFloat(t)<0)return;const s=h(t,i.availableAmount);o({...i,pricePerUnit:t,maxLimit:s})},Z=t=>{if(parseFloat(t)<0)return;const s=h(i.pricePerUnit,t);o({...i,availableAmount:t,maxLimit:s})};return e.jsx(ie,{children:e.jsxs("div",{className:"space-y-4 sm:space-y-6 pb-20 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground truncate",children:"Post Ad"}),(!U||P)&&e.jsxs(M,{open:Y,onOpenChange:y,children:[e.jsx(me,{asChild:!0,children:e.jsxs(l,{className:"bg-primary hover:bg-primary/90","data-testid":"button-create-offer",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"New Ad"]})}),e.jsxs(q,{className:"bg-card border-border max-w-lg",children:[e.jsx(V,{children:e.jsx($,{className:"text-foreground",children:"Create New Offer"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Type"}),e.jsxs(ce,{value:a.type,onValueChange:t=>d({...a,type:t}),children:[e.jsx(de,{className:"bg-muted border-border","data-testid":"select-offer-type",children:e.jsx(le,{})}),e.jsxs(oe,{children:[e.jsx(E,{value:"buy",children:"Buy"}),e.jsx(E,{value:"sell",children:"Sell"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Payment Currency"}),e.jsx(c,{type:"text",value:"USD",className:"bg-muted border-border opacity-60","data-testid":"input-offer-currency",readOnly:!0,disabled:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Price per Account (USD)"}),e.jsx(c,{type:"number",step:"0.01",min:"0",value:a.pricePerUnit,onChange:t=>I(t.target.value),className:"bg-muted border-border",placeholder:"e.g. 100","data-testid":"input-price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Available Accounts"}),e.jsx(c,{type:"number",step:"1",min:"1",value:a.availableAmount,onChange:t=>_(t.target.value),className:"bg-muted border-border",placeholder:"Number of accounts for sale","data-testid":"input-available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Min Limit (USD)"}),e.jsx(c,{type:"number",min:"0",value:a.minLimit,onChange:t=>Q(t.target.value),className:"bg-muted border-border","data-testid":"input-min-limit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Max Limit (USD)"}),e.jsx(c,{type:"number",value:a.maxLimit,className:"bg-muted border-border opacity-60","data-testid":"input-max-limit",readOnly:!0,disabled:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Account Type"}),e.jsx(c,{type:"text",value:a.accountType,onChange:t=>d({...a,accountType:t.target.value}),className:"bg-muted border-border",placeholder:"e.g. Binance, OKX, MEXC, Bybit, Custom...","data-testid":"input-account-type"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Terms (Optional)"}),e.jsx(D,{value:a.terms,onChange:t=>d({...a,terms:t.target.value}),className:"bg-muted border-border",placeholder:"Trade terms and conditions...","data-testid":"input-terms"})]}),e.jsx(l,{className:"w-full bg-primary hover:bg-primary/90",onClick:()=>v.mutate(a),disabled:v.isPending,"data-testid":"button-submit-offer",children:v.isPending?"Creating...":"Create Offer"})]})]})]})]}),z?e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{className:"h-24 bg-muted"}),e.jsx(C,{className:"h-24 bg-muted"})]}):U&&!P?e.jsx(k,{className:"bg-card border-border",children:e.jsxs(F,{className:"p-8 text-center",children:[e.jsx(pe,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"KYC Verification Required"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"You need to complete KYC verification before you can post ads. This helps us ensure a safe trading environment."}),e.jsx(l,{className:"bg-primary hover:bg-primary/90",onClick:()=>w("/settings"),"data-testid":"button-verify-kyc",children:"Complete KYC Verification"})]})}):e.jsxs(k,{className:"bg-card border-border",children:[e.jsx(re,{children:e.jsxs(ne,{className:"text-foreground flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"My Ads"]})}),e.jsx(F,{children:J?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsx(C,{className:"h-20 bg-muted"},t))}):j&&j.length>0?e.jsx("div",{className:"space-y-4",children:j.map(t=>e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border border-border","data-testid":`vendor-offer-${t.id}`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.type==="buy"?"bg-green-900/50":"bg-red-900/50"}`,children:t.type==="buy"?e.jsx(fe,{className:"h-5 w-5 text-green-400"}):e.jsx(ve,{className:"h-5 w-5 text-red-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-foreground font-medium",children:[t.type.toUpperCase()," ",t.currency]}),e.jsx(T,{variant:t.isActive?"default":"secondary",children:t.isActive?"Active":"Inactive"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["$",parseFloat(t.pricePerUnit).toFixed(2)," per unit"]}),t.accountDetails?.exchangeName&&e.jsxs("p",{className:"text-xs text-primary",children:[t.accountDetails.exchangeName," Account"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Limit: $",parseFloat(t.minLimit).toFixed(0)," - $",parseFloat(t.maxLimit).toFixed(0)]}),e.jsxs("p",{className:"text-muted-foreground",children:["Available: ",parseFloat(t.availableAmount).toFixed(4)," ",t.currency]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground",onClick:()=>W(t),"data-testid":`button-edit-${t.id}`,children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive/80",onClick:()=>X.mutate(t.id),"data-testid":`button-delete-${t.id}`,children:e.jsx(he,{className:"h-4 w-4"})})]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(T,{variant:"outline",className:"text-primary border-primary",children:[t.paymentMethods[0]?.replace(" UID","").replace(" Address","")||"Unknown"," Account"]})})]},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-foreground text-lg",children:"No ads yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first ad to start trading"}),e.jsxs(l,{className:"bg-primary hover:bg-primary/90",onClick:()=>y(!0),"data-testid":"button-create-first-ad",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Post Your First Ad"]})]})})]}),e.jsx(M,{open:B,onOpenChange:b,children:e.jsxs(q,{className:"bg-gray-900 border-gray-800 max-w-lg",children:[e.jsx(V,{children:e.jsx($,{className:"text-white",children:"Edit Offer"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Price per Account (USD)"}),e.jsx(c,{type:"number",step:"0.01",min:"0",value:i.pricePerUnit,onChange:t=>G(t.target.value),className:"bg-gray-800 border-gray-700","data-testid":"edit-input-price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Available Accounts"}),e.jsx(c,{type:"number",step:"1",min:"0",value:i.availableAmount,onChange:t=>Z(t.target.value),className:"bg-gray-800 border-gray-700","data-testid":"edit-input-available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Min Limit (USD)"}),e.jsx(c,{type:"number",min:"0",value:i.minLimit,onChange:t=>o({...i,minLimit:t.target.value}),className:"bg-gray-800 border-gray-700","data-testid":"edit-input-min-limit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Max Limit (USD)"}),e.jsx(c,{type:"number",value:i.maxLimit,className:"bg-gray-800 border-gray-700 opacity-60","data-testid":"edit-input-max-limit",readOnly:!0,disabled:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Terms (Optional)"}),e.jsx(D,{value:i.terms,onChange:t=>o({...i,terms:t.target.value}),className:"bg-gray-800 border-gray-700",placeholder:"Trade terms and conditions...","data-testid":"edit-input-terms"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.isActive,onChange:t=>o({...i,isActive:t.target.checked}),className:"rounded","data-testid":"edit-checkbox-active"}),e.jsx(r,{children:"Active (visible in marketplace)"})]}),e.jsx(l,{className:"w-full bg-purple-600 hover:bg-purple-700",onClick:()=>S&&N.mutate({offerId:S.id,updates:i}),disabled:N.isPending,"data-testid":"button-update-offer",children:N.isPending?"Updating...":"Update Offer"})]})]})})]})})}export{Re as default};
