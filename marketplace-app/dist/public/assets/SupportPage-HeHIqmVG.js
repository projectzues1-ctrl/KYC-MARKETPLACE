import{c as Ye,d as Ve,u as Oe,g as Be,b as Qe,r as i,a as p,j as e,S as j,X as ze,f as n}from"./index-B6hPo9fH.js";import{u as T}from"./useMutation-C_3TpXjp.js";import{L as He}from"./Layout-BTVfT1Q4.js";import{C as o,a as x,b as F,c as D}from"./card-Cl1MO1GN.js";import{B as t}from"./button-DdYfvWb9.js";import{B as u}from"./badge-Dn4EaI7W.js";import{I as je}from"./input-vnQcFn7U.js";import{T as Je,a as We,b as A,c as E}from"./tabs-YN5y1_yR.js";import{D as K,d as U,a as $,b as R,c as I,f as L,g as q,e as Ne}from"./dialog-D_lwzFP4.js";import{T as P}from"./textarea-Cc28xWq-.js";import{S as _e,a as Xe,b as Ge,c as Ze,d as ve}from"./select-_UnfLIee.js";import{L as N}from"./label-B38SsxLd.js";import{T as es,a as ss,b as ke,c as v,d as as,e as k}from"./table-ClTGZG61.js";import{u as rs}from"./useTranslation-O3_Fa0eH.js";import{a as ts,S as fe}from"./shopping-cart-DT7LSJeM.js";import{F as we}from"./file-text-CULx7Jr7.js";import{S as G,C as M}from"./ThemeToggle-Cd9vwdUm.js";import{U as Y}from"./index-Dt-oTuiC.js";import{I as Se}from"./image-IeDDDsTa.js";import{T as is}from"./triangle-alert-DGpOeCBb.js";import{S as Ce}from"./search-BRMhtFmq.js";import{K as ds}from"./key-avjJRGvV.js";import{F as ls}from"./flag-CuHtVT3T.js";import"./shield-DVigj7cn.js";import"./index-BdQq_4o_.js";import"./index-D8nDhomm.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ns=Ye("shield-check",cs);function Qs(){const{t:os}=rs(),{toast:r}=Ve(),y=Oe(),m=Be();Qe();const[xs,Te]=i.useState(null),[V,Z]=i.useState(""),[O,ee]=i.useState(""),[se,Fe]=i.useState("tier1"),[f,De]=i.useState(""),[gs,ms]=i.useState(null),[B,ae]=i.useState(""),[hs,ps]=i.useState(null),[us,ys]=i.useState(0),[Q,re]=i.useState(""),[z,te]=i.useState(""),[ie,de]=i.useState(!1),[d,H]=i.useState(null),[w,J]=i.useState(""),[S,le]=i.useState(!1),[ce,ne]=i.useState(!1),oe=m?.role==="admin",b=m?.role==="support",{data:W,isLoading:Ae}=p({queryKey:["support-pending-kyc"],queryFn:async()=>{const s=await n("/api/admin/kyc/pending");if(!s.ok)throw new Error("Failed to fetch pending KYC");return s.json()}}),{data:_,isLoading:Ee}=p({queryKey:["support-pending-vendors"],queryFn:async()=>{const s=await n("/api/admin/vendors/pending");if(!s.ok)throw new Error("Failed to fetch pending vendors");return s.json()}}),{data:xe,isLoading:Ke}=p({queryKey:["support-orders"],queryFn:async()=>{const s=await n("/api/support/orders");if(!s.ok)throw new Error("Failed to fetch orders");return s.json()}}),{data:c,isLoading:Ue,refetch:ge}=p({queryKey:["support-search-user",f],queryFn:async()=>{if(!f.trim())return null;const s=await n(`/api/support/user/search?username=${encodeURIComponent(f)}`);return s.ok?s.json():null},enabled:!1}),{data:g,isLoading:me}=p({queryKey:["support-tickets"],queryFn:async()=>{const s=await n("/api/support/tickets");if(!s.ok)throw new Error("Failed to fetch tickets");return s.json()}}),{data:l,isLoading:bs}=p({queryKey:["support-ticket",d],queryFn:async()=>{if(!d)return null;const s=await n(`/api/support/tickets/${d}`);if(!s.ok)throw new Error("Failed to fetch ticket");return s.json()},enabled:!!d}),C=T({mutationFn:async({id:s,status:a,tier:h,adminNotes:Pe,rejectionReason:Me})=>{const be=await n(`/api/admin/kyc/${s}/review`,{method:"POST",body:JSON.stringify({status:a,tier:h,adminNotes:Pe,rejectionReason:Me})});if(!be.ok)throw new Error("Failed to review KYC");return be.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["support-pending-kyc"]}),Te(null),Z(""),ee(""),r({title:"KYC Reviewed",description:"The KYC application has been processed"})},onError:()=>{r({variant:"destructive",title:"Error",description:"Failed to process KYC review"})}}),he=T({mutationFn:async s=>{const a=await n(`/api/admin/vendors/${s}/approve`,{method:"POST"});if(!a.ok)throw new Error("Failed to approve vendor");return a.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["support-pending-vendors"]}),r({title:"Vendor Approved",description:"The vendor has been approved"})},onError:()=>{r({variant:"destructive",title:"Error",description:"Failed to approve vendor"})}}),pe=T({mutationFn:async s=>{const a=await n(`/api/support/user/${s}/reset-2fa`,{method:"POST"});if(!a.ok)throw new Error("Failed to reset 2FA");return a.json()},onSuccess:()=>{r({title:"2FA Reset",description:"User's 2FA has been disabled"}),ge()},onError:()=>{r({variant:"destructive",title:"Error",description:"Failed to reset 2FA"})}}),ue=T({mutationFn:async({userId:s,reason:a})=>{const h=await n(`/api/support/user/${s}/flag`,{method:"POST",body:JSON.stringify({reason:a})});if(!h.ok)throw new Error("Failed to flag user");return h.json()},onSuccess:()=>{r({title:"User Flagged",description:"Suspicious behavior has been reported"}),ae("")},onError:()=>{r({variant:"destructive",title:"Error",description:"Failed to flag user"})}}),X=s=>{const a=s.idFrontUrl&&s.idBackUrl&&s.selfieUrl,h=s.idDocumentUrl&&s.selfieUrl;return a||h},$e=s=>{if(!X(s)){r({variant:"destructive",title:"Cannot Approve",description:"User must upload required documents"});return}C.mutate({id:s.id,status:"approved",tier:se,adminNotes:V})},Re=s=>{if(!O.trim()){r({variant:"destructive",title:"Error",description:"Please provide a rejection reason"});return}C.mutate({id:s.id,status:"rejected",tier:s.tier,adminNotes:V,rejectionReason:O})},Ie=s=>{s.preventDefault(),ge()},Le=async s=>{if(s.preventDefault(),!Q.trim()||!z.trim()){r({variant:"destructive",title:"Error",description:"Please fill in all fields"});return}de(!0);try{if(!(await n("/api/support/tickets",{method:"POST",body:JSON.stringify({subject:Q,message:z})})).ok)throw new Error("Failed to submit ticket");r({title:"Success",description:"Your support ticket has been created. We'll respond soon!"}),re(""),te(""),y.invalidateQueries({queryKey:["support-tickets"]})}catch{r({variant:"destructive",title:"Error",description:"Failed to create support ticket"})}finally{de(!1)}},ye=async s=>{if(s.preventDefault(),!w.trim()||!d){r({variant:"destructive",title:"Error",description:"Please enter a message"});return}le(!0);try{if(!(await n(`/api/support/tickets/${d}/messages`,{method:"POST",body:JSON.stringify({message:w})})).ok)throw new Error("Failed to send message");r({title:"Success",description:"Message sent!"}),J(""),y.invalidateQueries({queryKey:["support-ticket",d]})}catch{r({variant:"destructive",title:"Error",description:"Failed to send message"})}finally{le(!1)}},qe=async()=>{if(d){ne(!0);try{if(!(await n(`/api/support/tickets/${d}/solve`,{method:"PATCH"})).ok)throw new Error("Failed to solve ticket");r({title:"Success",description:"Ticket marked as solved!"}),H(null),y.invalidateQueries({queryKey:["support-tickets"]})}catch{r({variant:"destructive",title:"Error",description:"Failed to solve ticket"})}finally{ne(!1)}}};return e.jsx(He,{children:e.jsxs("div",{className:"space-y-4 sm:space-y-6 px-2 sm:px-4","data-testid":"support-page",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(ts,{className:"h-6 sm:h-8 w-6 sm:w-8 text-green-500 flex-shrink-0"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white truncate",children:"Customer Support"})]}),!oe&&!b&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 min-h-96",children:[e.jsxs("div",{className:"lg:col-span-1 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-800 overflow-hidden flex flex-col min-h-96",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800",children:e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:["Your Tickets (",g?.length||0,")"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 p-2",children:me?e.jsx("div",{className:"space-y-2 p-2",children:[1,2,3].map(s=>e.jsx(j,{className:"h-12 bg-gray-200 dark:bg-gray-800"},s))}):!g||g.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No tickets yet"}):g.map(s=>e.jsxs("button",{onClick:()=>H(s.id),className:`w-full text-left p-3 rounded-lg transition-colors ${d===s.id?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"}`,"data-testid":`ticket-item-${s.id}`,children:[e.jsx("div",{className:"font-medium text-sm truncate",children:s.subject}),e.jsx("div",{className:`text-xs truncate ${d===s.id?"text-blue-100":"text-gray-500 dark:text-gray-400"}`,children:new Date(s.createdAt).toLocaleDateString()})]},s.id))})]}),e.jsx("div",{className:"lg:col-span-3 bg-white dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-800 overflow-hidden flex flex-col min-h-96",children:d&&l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:l.subject}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Status: ",e.jsx("span",{className:"capitalize",children:l.status})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[e.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:l.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(l.createdAt).toLocaleString()})]}),l.messages?.sort((s,a)=>new Date(s.createdAt).getTime()-new Date(a.createdAt).getTime()).map(s=>e.jsx("div",{className:`flex ${s.senderId===m?.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`p-3 rounded-lg max-w-xs ${s.senderId===m?.id?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"}`,children:[e.jsx("p",{className:"text-sm",children:s.message}),e.jsx("p",{className:`text-xs mt-1 ${s.senderId===m?.id?"text-blue-100":"text-gray-500"}`,children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},s.id))]}),e.jsxs("form",{onSubmit:ye,className:"p-4 border-t border-gray-200 dark:border-gray-800 flex gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:s=>J(s.target.value),placeholder:"Type a message...",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm","data-testid":"input-message"}),e.jsx(t,{type:"submit",disabled:S,className:"bg-blue-600 hover:bg-blue-700 text-white","data-testid":"button-send-message",children:S?"...":"Send"})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsxs("form",{onSubmit:Le,className:"w-full max-w-md space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white text-center",children:"Create a New Support Ticket"}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"subject",className:"text-gray-700 dark:text-gray-300",children:"Subject"}),e.jsx(je,{id:"subject",placeholder:"What's the issue?",value:Q,onChange:s=>re(s.target.value),className:"mt-2 bg-white dark:bg-gray-800","data-testid":"input-ticket-subject"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"message",className:"text-gray-700 dark:text-gray-300",children:"Message"}),e.jsx(P,{id:"message",placeholder:"Describe the issue...",value:z,onChange:s=>te(s.target.value),className:"mt-2 bg-white dark:bg-gray-800 min-h-24","data-testid":"textarea-ticket-message"})]}),e.jsx(t,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:ie,"data-testid":"button-submit-ticket",children:ie?"Submitting...":"Create Ticket"})]})})})]}),b&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 min-h-96",children:[e.jsxs("div",{className:"lg:col-span-1 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-800 overflow-hidden flex flex-col min-h-96",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800",children:e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:["Support Queue (",g?.filter(s=>s.status!=="solved").length||0,")"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 p-2",children:me?e.jsx("div",{className:"space-y-2 p-2",children:[1,2,3].map(s=>e.jsx(j,{className:"h-12 bg-gray-200 dark:bg-gray-800"},s))}):!g||g.filter(s=>s.status!=="solved").length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No open tickets"}):g.filter(s=>s.status!=="solved").map(s=>e.jsxs("button",{onClick:()=>H(s.id),className:`w-full text-left p-3 rounded-lg transition-colors ${d===s.id?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"}`,"data-testid":`support-ticket-${s.id}`,children:[e.jsx("div",{className:"font-medium text-sm truncate",children:s.subject}),e.jsx("div",{className:`text-xs truncate ${d===s.id?"text-blue-100":"text-gray-500 dark:text-gray-400"}`,children:g.find(a=>a.id===s.id)&&new Date(s.createdAt).toLocaleDateString()})]},s.id))})]}),e.jsx("div",{className:"lg:col-span-3 bg-white dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-800 overflow-hidden flex flex-col min-h-96",children:d&&l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:l.subject}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["From: ",e.jsx("span",{className:"font-medium",children:l.userId})," | Status: ",e.jsx("span",{className:"capitalize",children:l.status})]})]}),b&&l.status!=="solved"&&e.jsx(t,{onClick:qe,disabled:ce,className:"bg-green-600 hover:bg-green-700 text-white whitespace-nowrap ml-4","data-testid":"button-solve-ticket",children:ce?"...":"Solved"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[e.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:l.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(l.createdAt).toLocaleString()})]}),l.messages?.sort((s,a)=>new Date(s.createdAt).getTime()-new Date(a.createdAt).getTime()).map(s=>e.jsx("div",{className:`flex ${s.senderId===m?.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`p-3 rounded-lg max-w-xs ${s.senderId===m?.id?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"}`,children:[e.jsx("p",{className:"text-sm",children:s.message}),e.jsx("p",{className:`text-xs mt-1 ${s.senderId===m?.id?"text-blue-100":"text-gray-500"}`,children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},s.id))]}),e.jsxs("form",{onSubmit:ye,className:"p-4 border-t border-gray-200 dark:border-gray-800 flex gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:s=>J(s.target.value),placeholder:"Type your response...",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm","data-testid":"support-input-message"}),e.jsx(t,{type:"submit",disabled:S,className:"bg-blue-600 hover:bg-blue-700 text-white","data-testid":"support-button-send",children:S?"...":"Reply"})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center p-4 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Select a ticket from the queue to respond"})})})]}),(oe||b)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(o,{className:"bg-gradient-to-br from-blue-900/40 to-blue-800/30 border-blue-700",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:"h-10 w-10 text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-300 text-sm",children:"Pending KYC"}),e.jsx("p",{className:"text-3xl font-bold text-white","data-testid":"pending-kyc-count",children:W?.length||0})]})]})})}),e.jsx(o,{className:"bg-gradient-to-br from-purple-900/40 to-purple-800/30 border-purple-700",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-10 w-10 text-purple-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-300 text-sm",children:"Pending Vendors"}),e.jsx("p",{className:"text-3xl font-bold text-white","data-testid":"pending-vendors-count",children:_?.length||0})]})]})})}),e.jsx(o,{className:"bg-gradient-to-br from-green-900/40 to-green-800/30 border-green-700",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ns,{className:"h-10 w-10 text-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-300 text-sm",children:"Role"}),e.jsx("p",{className:"text-xl font-bold text-white",children:b?"Support Staff":"Admin"})]})]})})})]}),e.jsxs(Je,{defaultValue:"kyc",className:"space-y-4",children:[e.jsxs(We,{className:"bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700",children:[e.jsxs(A,{value:"kyc","data-testid":"tab-kyc",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"KYC Applications"]}),e.jsxs(A,{value:"vendors","data-testid":"tab-vendors",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Pending Vendors"]}),e.jsxs(A,{value:"orders","data-testid":"tab-orders",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Orders"]}),e.jsxs(A,{value:"users","data-testid":"tab-users",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"User Lookup"]})]}),e.jsx(E,{value:"kyc",className:"space-y-4",children:Ae?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(j,{className:"h-48 bg-gray-200 dark:bg-gray-800"},s))}):W?.length===0?e.jsx(o,{className:"bg-gray-100 dark:bg-gray-900/50 border-gray-300 dark:border-gray-800",children:e.jsxs(x,{className:"py-12 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No pending KYC applications"})]})}):W?.map(s=>e.jsxs(o,{className:"bg-gray-100 dark:bg-gray-900/50 border-gray-300 dark:border-gray-800","data-testid":`kyc-card-${s.id}`,children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(D,{className:"text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"KYC Application"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 dark:text-yellow-500 border-yellow-500",children:s.status}),e.jsx(u,{variant:"outline",children:s.tier})]})]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"ID Type"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:s.idType||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"ID Number"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:s.idNumber||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Face Match Score"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:s.faceMatchScore?`${s.faceMatchScore}%`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Submitted"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:new Date(s.submittedAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.idFrontUrl&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm flex items-center gap-1",children:[e.jsx(Se,{className:"h-4 w-4"}),"ID Front"]}),e.jsx("img",{src:s.idFrontUrl,alt:"ID Front",className:"w-full h-40 object-cover rounded-lg border border-gray-300 dark:border-gray-700"})]}),s.idBackUrl&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm flex items-center gap-1",children:[e.jsx(Se,{className:"h-4 w-4"}),"ID Back"]}),e.jsx("img",{src:s.idBackUrl,alt:"ID Back",className:"w-full h-40 object-cover rounded-lg border border-gray-300 dark:border-gray-700"})]}),s.selfieUrl&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm flex items-center gap-1",children:[e.jsx(Y,{className:"h-4 w-4"}),"Selfie"]}),e.jsx("img",{src:s.selfieUrl,alt:"Selfie",className:"w-full h-40 object-cover rounded-lg border border-gray-300 dark:border-gray-700"})]})]}),!X(s)&&e.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-700 rounded-lg",children:e.jsxs("p",{className:"text-yellow-700 dark:text-yellow-400 text-sm flex items-center gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Cannot approve: User must upload required documents (ID document + selfie)"]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t border-gray-300 dark:border-gray-800",children:[e.jsxs(K,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(t,{className:"bg-green-600 hover:bg-green-700",disabled:!X(s),"data-testid":`button-approve-kyc-${s.id}`,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Approve"]})}),e.jsxs($,{className:"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800",children:[e.jsx(R,{children:e.jsx(I,{className:"text-gray-900 dark:text-white",children:"Approve KYC"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"text-gray-600 dark:text-gray-400",children:"Verification Tier"}),e.jsxs(_e,{value:se,onValueChange:Fe,children:[e.jsx(Xe,{className:"bg-gray-50 dark:bg-gray-800 border-gray-300 dark:border-gray-700",children:e.jsx(Ge,{})}),e.jsxs(Ze,{className:"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700",children:[e.jsx(ve,{value:"tier1",children:"Tier 1"}),e.jsx(ve,{value:"tier2",children:"Tier 2"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"text-gray-600 dark:text-gray-400",children:"Notes (optional)"}),e.jsx(P,{value:V,onChange:a=>Z(a.target.value),placeholder:"Add any notes...",className:"bg-gray-50 dark:bg-gray-800 border-gray-300 dark:border-gray-700"})]})]}),e.jsxs(L,{children:[e.jsx(q,{asChild:!0,children:e.jsx(t,{variant:"outline",className:"border-gray-300 dark:border-gray-700",children:"Cancel"})}),e.jsx(t,{className:"bg-green-600 hover:bg-green-700",onClick:()=>$e(s),disabled:C.isPending,children:"Confirm Approval"})]})]})]}),e.jsxs(K,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(t,{variant:"destructive","data-testid":`button-reject-kyc-${s.id}`,children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Reject"]})}),e.jsxs($,{className:"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800",children:[e.jsx(R,{children:e.jsx(I,{className:"text-gray-900 dark:text-white",children:"Reject KYC"})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"text-gray-600 dark:text-gray-400",children:"Rejection Reason (required)"}),e.jsx(P,{value:O,onChange:a=>ee(a.target.value),placeholder:"Explain why this KYC is being rejected...",className:"bg-gray-50 dark:bg-gray-800 border-gray-300 dark:border-gray-700"})]})}),e.jsxs(L,{children:[e.jsx(q,{asChild:!0,children:e.jsx(t,{variant:"outline",className:"border-gray-300 dark:border-gray-700",children:"Cancel"})}),e.jsx(t,{variant:"destructive",onClick:()=>Re(s),disabled:C.isPending,children:"Confirm Rejection"})]})]})]})]})]})]},s.id))}),e.jsx(E,{value:"vendors",className:"space-y-4",children:Ee?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(j,{className:"h-32 bg-gray-200 dark:bg-gray-800"},s))}):_?.length===0?e.jsx(o,{className:"bg-gray-100 dark:bg-gray-900/50 border-gray-300 dark:border-gray-800",children:e.jsxs(x,{className:"py-12 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No pending vendor applications"})]})}):_?.map(s=>e.jsxs(o,{className:"bg-gray-100 dark:bg-gray-900/50 border-gray-300 dark:border-gray-800","data-testid":`vendor-card-${s.id}`,children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(D,{className:"text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),s.businessName||"Vendor Application"]}),e.jsx(u,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 dark:text-yellow-500 border-yellow-500",children:"Pending Approval"})]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Country"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:s.country})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bio"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:s.bio||"No bio provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Applied"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:new Date(s.createdAt).toLocaleDateString()})]})]}),e.jsxs(t,{className:"bg-green-600 hover:bg-green-700",onClick:()=>he.mutate(s.id),disabled:he.isPending,"data-testid":`button-approve-vendor-${s.id}`,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Approve Vendor"]})]})]},s.id))}),e.jsx(E,{value:"orders",className:"space-y-4",children:e.jsxs(o,{className:"bg-gray-100 dark:bg-gray-900/50 border-gray-300 dark:border-gray-800",children:[e.jsx(F,{children:e.jsxs(D,{className:"text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"All Orders"]})}),e.jsx(x,{children:Ke?e.jsx(j,{className:"h-64 bg-gray-200 dark:bg-gray-800"}):xe?.length===0?e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center py-8",children:"No orders found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(es,{children:[e.jsx(ss,{children:e.jsxs(ke,{className:"border-gray-300 dark:border-gray-700",children:[e.jsx(v,{className:"text-gray-600 dark:text-gray-400",children:"Order ID"}),e.jsx(v,{className:"text-gray-600 dark:text-gray-400",children:"Status"}),e.jsx(v,{className:"text-gray-600 dark:text-gray-400",children:"Fiat Amount"}),e.jsx(v,{className:"text-gray-600 dark:text-gray-400",children:"Crypto Amount"}),e.jsx(v,{className:"text-gray-600 dark:text-gray-400",children:"Date"})]})}),e.jsx(as,{children:xe?.slice(0,50).map(s=>e.jsxs(ke,{className:"border-gray-300 dark:border-gray-700","data-testid":`order-row-${s.id}`,children:[e.jsxs(k,{className:"text-gray-600 dark:text-gray-300 font-mono text-xs",children:[s.id.slice(0,8),"..."]}),e.jsx(k,{children:e.jsx(u,{className:s.status==="completed"?"bg-green-600":s.status==="escrowed"?"bg-blue-600":s.status==="paid"?"bg-purple-600":s.status==="disputed"?"bg-red-600":"bg-yellow-600",children:s.status})}),e.jsxs(k,{className:"text-gray-900 dark:text-white font-medium",children:["$",s.fiatAmount]}),e.jsx(k,{className:"text-gray-900 dark:text-white",children:s.cryptoAmount}),e.jsx(k,{className:"text-gray-600 dark:text-gray-300",children:new Date(s.createdAt).toLocaleDateString()})]},s.id))})]})})})]})}),e.jsx(E,{value:"users",className:"space-y-4",children:e.jsxs(o,{className:"bg-gray-100 dark:bg-gray-900/50 border-gray-300 dark:border-gray-800",children:[e.jsx(F,{children:e.jsxs(D,{className:"text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"User Lookup"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:Ie,className:"flex gap-2",children:[e.jsx(je,{value:f,onChange:s=>De(s.target.value),placeholder:"Enter username to search...",className:"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700","data-testid":"input-search-username"}),e.jsxs(t,{type:"submit",disabled:Ue,"data-testid":"button-search-user",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Search"]})]}),c&&e.jsx(o,{className:"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700",children:e.jsxs(x,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"h-10 w-10 text-gray-500 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:c.username}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c.email})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:c.isFrozen?"destructive":"default",children:c.isFrozen?"Frozen":"Active"}),e.jsx(u,{variant:"outline",children:c.role})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"KYC Status"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.kycStatus||"Not submitted"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"2FA Enabled"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.twoFactorEnabled?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Email Verified"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:c.emailVerified?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Joined"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:new Date(c.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t border-gray-200 dark:border-gray-700",children:[c.twoFactorEnabled&&e.jsxs(K,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(t,{variant:"outline",className:"border-orange-500 text-orange-500 hover:bg-orange-500/10","data-testid":"button-reset-2fa",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Reset 2FA"]})}),e.jsxs($,{className:"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800",children:[e.jsxs(R,{children:[e.jsx(I,{className:"text-gray-900 dark:text-white",children:"Reset 2FA"}),e.jsx(Ne,{className:"text-gray-600 dark:text-gray-400",children:"This will disable 2FA for this user. They will need to set it up again."})]}),e.jsxs(L,{children:[e.jsx(q,{asChild:!0,children:e.jsx(t,{variant:"outline",children:"Cancel"})}),e.jsx(t,{className:"bg-orange-600 hover:bg-orange-700",onClick:()=>pe.mutate(c.id),disabled:pe.isPending,children:"Confirm Reset"})]})]})]}),e.jsxs(K,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(t,{variant:"outline",className:"border-red-500 text-red-500 hover:bg-red-500/10","data-testid":"button-flag-user",children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),"Flag Suspicious"]})}),e.jsxs($,{className:"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800",children:[e.jsxs(R,{children:[e.jsx(I,{className:"text-gray-900 dark:text-white",children:"Flag Suspicious Behavior"}),e.jsx(Ne,{className:"text-gray-600 dark:text-gray-400",children:"Report this user for suspicious activity. This will be reviewed by admins."})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(P,{value:B,onChange:s=>ae(s.target.value),placeholder:"Describe the suspicious behavior...",className:"bg-gray-50 dark:bg-gray-800 border-gray-300 dark:border-gray-700"})}),e.jsxs(L,{children:[e.jsx(q,{asChild:!0,children:e.jsx(t,{variant:"outline",children:"Cancel"})}),e.jsx(t,{variant:"destructive",onClick:()=>ue.mutate({userId:c.id,reason:B}),disabled:ue.isPending||!B.trim(),children:"Submit Report"})]})]})]})]})]})})]})]})})]})]})]})})}export{Qs as default};
