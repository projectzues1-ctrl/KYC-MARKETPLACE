import{c as z,l as Pe,d as Ae,u as Oe,g as Ee,b as qe,r as o,a as M,j as e,S,f as c}from"./index-B6hPo9fH.js";import{u as m}from"./useMutation-C_3TpXjp.js";import{L as I}from"./Layout-BTVfT1Q4.js";import{C as re,b as ie,c as ne,a as oe}from"./card-Cl1MO1GN.js";import{B as n}from"./button-DdYfvWb9.js";import{B as $e}from"./badge-Dn4EaI7W.js";import{I as le}from"./input-vnQcFn7U.js";import{C as Te}from"./checkbox-BZSYmHI3.js";import{D as L,a as R,b as K,c as _,e as Q}from"./dialog-D_lwzFP4.js";import{L as U}from"./label-B38SsxLd.js";import{T as de}from"./textarea-Cc28xWq-.js";import{u as Me}from"./useTranslation-O3_Fa0eH.js";import{T as F}from"./triangle-alert-DGpOeCBb.js";import{S as Ie}from"./shield-DVigj7cn.js";import{D as g}from"./dollar-sign-pMvEizJe.js";import{L as ce}from"./lock-67rVn5Zl.js";import{A as B}from"./arrow-right-B_TWW9GO.js";import{L as me}from"./lock-open-New0CUEt.js";import{C as Le}from"./circle-check-big-BkJjytOF.js";import{C as Re}from"./circle-x-Cd9ohy9Q.js";import{S as J}from"./star-CUTTDGaz.js";import{C as Ke}from"./clock-BbwHj01_.js";import{M as ue,S as _e}from"./send-DvM8hF-_.js";import{K as Qe}from"./key-round-lLdNQHG2.js";import{I as Ue}from"./image-IeDDDsTa.js";import{F as Be}from"./file-text-CULx7Jr7.js";import"./ThemeToggle-Cd9vwdUm.js";import"./index-Dt-oTuiC.js";import"./shopping-cart-DT7LSJeM.js";import"./index-D8nDhomm.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],ze=z("file",Je);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],We=z("paperclip",Ve);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Ye=z("video",He);function At(){const{t:Ge}=Me(),[,pe]=Pe("/order/:id"),r=pe?.id,{toast:i}=Ae(),d=Oe(),p=Ee(),[,he]=qe(),[x,V]=o.useState(""),W=o.useRef(null),H=o.useRef(null),[Y,ge]=o.useState(!1),[xe,f]=o.useState(!1),[C,y]=o.useState(""),[fe,b]=o.useState(!1),[D,P]=o.useState(""),[Xe,G]=o.useState(!1),[Ze,ye]=o.useState(""),[be,w]=o.useState(!1),[A,O]=o.useState(5),[X,E]=o.useState(""),{data:s,isLoading:we}=M({queryKey:["order",r],queryFn:async()=>{const t=await c(`/api/orders/${r}`);if(!t.ok)throw new Error("Failed to fetch order");return t.json()},enabled:!!r,retry:3,retryDelay:1e3}),{data:j,isLoading:je}=M({queryKey:["messages",r],queryFn:async()=>(await c(`/api/orders/${r}/messages`)).json(),enabled:!!r,refetchInterval:5e3}),Z=m({mutationFn:async t=>{const a=await c(`/api/orders/${r}/messages`,{method:"POST",body:JSON.stringify({message:t})});if(!a.ok)throw new Error("Failed to send message");return a.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["messages",r]}),V("")}}),ee=m({mutationFn:async t=>{const a=new FormData;a.append("file",t);const l=localStorage.getItem("token"),k=await fetch(`/api/orders/${r}/messages/upload`,{method:"POST",headers:{Authorization:`Bearer ${l}`},body:a});if(!k.ok)throw new Error("Failed to upload file");return k.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["messages",r]}),i({title:"File uploaded",description:"File sent successfully"})},onError:()=>{i({variant:"destructive",title:"Failed to upload file"})}}),ve=t=>{const a=t.target.files?.[0];a&&(ee.mutate(a),t.target.value="")},Ne=t=>{const a=t.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif"].includes(a||"")?Ue:["mp4","mov","avi","webm"].includes(a||"")?Ye:["pdf","doc","docx"].includes(a||"")?Be:ze},ke=t=>{const a=t.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif"].includes(a||"")},v=m({mutationFn:async()=>{const t=await c(`/api/orders/${r}/paid`,{method:"POST"});if(!t.ok)throw new Error("Failed to mark as paid");return t.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["order",r]}),i({title:"Payment marked",description:"Waiting for vendor confirmation"})},onError:()=>{i({variant:"destructive",title:"Failed to mark payment"})}}),h=m({mutationFn:async t=>{const a=await c(`/api/orders/${r}/confirm`,{method:"POST",body:JSON.stringify({twoFactorToken:t})}),l=await a.json();if(!a.ok)throw l.requires2FASetup?new Error("requires2FASetup"):l.requires2FA?new Error("requires2FA"):new Error(l.message||"Failed to confirm delivery");return l},onSuccess:t=>{f(!1),y(""),d.invalidateQueries({queryKey:["order",r]}),d.invalidateQueries({queryKey:["wallet"]}),i({title:"Delivery Confirmed!",description:`Payment released to seller (${t.sellerAmount} USDT after 20% platform fee)`})},onError:t=>{if(t.message==="requires2FASetup"){i({variant:"destructive",title:"2FA Required",description:"You must enable two-factor authentication before confirming delivery. Go to Settings > Security to enable 2FA."}),he("/settings");return}if(t.message==="requires2FA"){f(!0);return}y(""),i({variant:"destructive",title:"Failed to confirm delivery",description:t.message})}}),te=m({mutationFn:async(t=void 0)=>{const a=await c(`/api/orders/${r}/deliver`,{method:"POST",body:JSON.stringify({deliveryDetails:t})});if(!a.ok)throw new Error("Failed to mark as delivered");return a.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["order",r]}),i({title:"Product Delivered",description:"Waiting for buyer to confirm receipt"})},onError:()=>{i({variant:"destructive",title:"Failed to mark as delivered"})}}),N=m({mutationFn:async t=>{const a=await c(`/api/orders/${r}/dispute`,{method:"POST",body:JSON.stringify({reason:t})});if(!a.ok)throw new Error("Failed to open dispute");return a.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["order",r]}),b(!1),P(""),i({title:"Dispute opened",description:"An admin will review your case"})},onError:()=>{i({variant:"destructive",title:"Failed to open dispute"})}}),Se=m({mutationFn:async t=>{const a=await c(`/api/orders/${r}/cancel`,{method:"POST",body:JSON.stringify({reason:t})});if(!a.ok){const l=await a.json();throw new Error(l.message||"Failed to cancel order")}return a.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["order",r]}),G(!1),ye(""),i({title:"Order cancelled",description:"The order has been cancelled and any escrowed funds have been refunded"})},onError:t=>{i({variant:"destructive",title:"Failed to cancel order",description:t.message})}}),q=m({mutationFn:async({stars:t,comment:a})=>{const l=await c(`/api/orders/${r}/feedback`,{method:"POST",body:JSON.stringify({stars:t,comment:a})});if(!l.ok){const k=await l.json();throw new Error(k.message||"Failed to submit feedback")}return l.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["feedback",r]}),w(!1),O(5),E(""),i({title:"Feedback submitted",description:"Thank you for your feedback!"})},onError:t=>{i({variant:"destructive",title:"Failed to submit feedback",description:t.message})}}),{data:Fe}=M({queryKey:["feedback",r],queryFn:async()=>(await c(`/api/orders/${r}/feedback`)).json(),enabled:!!r&&s?.status==="completed"}),se=m({mutationFn:async()=>{const t=await c(`/api/orders/${r}/deposit`,{method:"POST"});if(!t.ok){const a=await t.json();throw new Error(a.message||"Failed to deposit")}return t.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["order",r]}),d.invalidateQueries({queryKey:["wallet"]}),i({title:"Funds Deposited!",description:"Funds are now in escrow. Waiting for seller to deliver."})},onError:t=>{i({variant:"destructive",title:"Failed to deposit",description:t.message})}});o.useEffect(()=>{W.current?.scrollIntoView({behavior:"smooth"})},[j]);const Ce=t=>{t.preventDefault(),x.trim()&&Z.mutate(x)},u=s?.buyerId===p?.id,$=s?.tradeIntent==="buy_ad",De=t=>{switch(t){case"awaiting_deposit":return 0;case"escrowed":return 1;case"created":return 1;case"paid":return 2;case"confirmed":return 3;case"completed":return 4;default:return 0}},ae=$?[{label:"Deposit Required",icon:g},{label:"Funds in Escrow",icon:ce},{label:"Product Delivered",icon:B},{label:"Completed",icon:me}]:[{label:"Funds in Escrow",icon:ce},{label:"Payment Sent",icon:g},{label:"Product Delivered",icon:B},{label:"Completed",icon:me}];if(we)return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(S,{className:"h-12 w-64 bg-gray-800"}),e.jsx(S,{className:"h-64 bg-gray-800"}),e.jsx(S,{className:"h-96 bg-gray-800"})]})});if(!s)return e.jsx(I,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"h-12 w-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Order not found"})]})});const T=De(s.status);return e.jsx(I,{children:e.jsxs("div",{className:"space-y-4 sm:space-y-6 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-white truncate",children:["Order #",s.id.slice(0,8)]}),e.jsx($e,{className:s.status==="completed"?"bg-green-600":s.status==="disputed"?"bg-orange-600":s.status==="cancelled"?"bg-red-600":s.status==="awaiting_deposit"?"bg-yellow-600":s.status==="escrowed"?"bg-purple-600":"bg-blue-600",children:s.status==="awaiting_deposit"?"Awaiting Deposit":s.status==="escrowed"?"Funds Escrowed":s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),e.jsxs(re,{className:"bg-gray-900/50 border-gray-800",children:[e.jsx(ie,{children:e.jsxs(ne,{className:"text-white flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-purple-400"}),"Order Progress"]})}),e.jsxs(oe,{children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:ae.map((t,a)=>e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${a<T?"bg-green-600":a===T?"bg-purple-600":"bg-gray-700"}`,children:e.jsx(t.icon,{className:"h-6 w-6 text-white"})}),e.jsx("p",{className:"text-sm text-gray-400 mt-2 text-center",children:t.label}),a<ae.length-1&&e.jsx("div",{className:`absolute top-6 left-12 w-full h-0.5 ${a<T?"bg-green-600":"bg-gray-700"}`,style:{width:"calc(100% + 2rem)"}})]},a))}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Accounts"}),e.jsxs("p",{className:"text-white font-bold",children:[Math.floor(parseFloat(s.amount))," account",Math.floor(parseFloat(s.amount))!==1?"s":""]})]}),e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Total Price"}),e.jsxs("p",{className:"text-white font-bold",children:["$",Math.floor(parseFloat(s.fiatAmount))]})]}),e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Payment Method"}),e.jsx("p",{className:"text-white font-bold",children:s.paymentMethod})]}),e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Price/Account"}),e.jsxs("p",{className:"text-white font-bold",children:["$",Math.floor(parseFloat(s.pricePerUnit))]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[u&&$&&s.status==="awaiting_deposit"&&e.jsxs(n,{className:"bg-green-600 hover:bg-green-700",onClick:()=>se.mutate(),disabled:se.isPending,"data-testid":"button-deposit-funds",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Deposit $",parseFloat(s.fiatAmount).toFixed(2)," to Escrow"]}),u&&!$&&s.status==="escrowed"&&e.jsxs(n,{className:"bg-green-600 hover:bg-green-700",onClick:()=>v.mutate(),disabled:v.isPending,"data-testid":"button-mark-paid",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"I've Sent Payment"]}),u&&s.status==="created"&&e.jsxs(n,{className:"bg-green-600 hover:bg-green-700",onClick:()=>v.mutate(),disabled:v.isPending,"data-testid":"button-mark-paid",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"I've Sent Payment"]}),!u&&(s.status==="paid"||s.status==="escrowed")&&e.jsxs(n,{className:"bg-green-600 hover:bg-green-700",onClick:()=>te.mutate(void 0),disabled:te.isPending,"data-testid":"button-deliver-product",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Deliver Product"]}),u&&s.status==="confirmed"&&e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx("div",{className:"p-4 bg-yellow-900/30 border border-yellow-700 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{id:"confirm-account-details",checked:Y,onCheckedChange:t=>ge(t===!0),"data-testid":"checkbox-confirm-account-details"}),e.jsx("label",{htmlFor:"confirm-account-details",className:"text-yellow-300 text-sm cursor-pointer",children:"I confirm that I have received and verified the account details provided by the seller in the chat. I understand that once I release payment, this action cannot be undone."})]})}),e.jsxs(n,{className:"bg-green-600 hover:bg-green-700",onClick:()=>h.mutate(void 0),disabled:h.isPending||!Y,"data-testid":"button-confirm-delivery",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Confirm Delivery (Release Payment)"]})]}),(s.status==="created"||s.status==="escrowed"||s.status==="paid"||s.status==="confirmed")&&e.jsxs(n,{variant:"outline",className:"border-orange-600 text-orange-400 hover:bg-orange-600/20",onClick:()=>b(!0),disabled:N.isPending,"data-testid":"button-open-dispute",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Open Dispute"]}),(s.status==="created"||s.status==="escrowed")&&e.jsxs(n,{variant:"outline",className:"border-red-600 text-red-400 hover:bg-red-600/20",onClick:()=>G(!0),disabled:Se.isPending,"data-testid":"button-cancel-order",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Cancel Order"]}),s.status==="completed"&&!Fe?.hasSubmitted&&e.jsxs(n,{className:"bg-yellow-600 hover:bg-yellow-700",onClick:()=>w(!0),"data-testid":"button-leave-feedback",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Leave Feedback"]})]}),s.status==="awaiting_deposit"&&u&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-900/30 border border-yellow-700 rounded-lg flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-yellow-400"}),e.jsxs("p",{className:"text-yellow-300 text-sm",children:["Please deposit $",parseFloat(s.fiatAmount).toFixed(2)," USDT to proceed with this order."]})]}),s.autoReleaseAt&&s.status==="paid"&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-900/30 border border-yellow-700 rounded-lg flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-yellow-400"}),e.jsxs("p",{className:"text-yellow-300 text-sm",children:["Auto-release at: ",new Date(s.autoReleaseAt).toLocaleString()]})]})]})]}),e.jsxs(re,{className:"bg-gray-900/50 border-gray-800",children:[e.jsx(ie,{children:e.jsxs(ne,{className:"text-white flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Order Chat"]})}),e.jsxs(oe,{children:[e.jsxs("div",{className:"h-96 overflow-y-auto mb-4 space-y-4 p-4 bg-gray-800/50 rounded-lg",children:[je?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx(S,{className:"h-12 bg-gray-700"},t))}):j&&j.length>0?j.map(t=>e.jsx("div",{className:`flex ${t.isSystemMessage?"justify-center":t.senderId===p?.id?"justify-end":"justify-start"}`,"data-testid":`message-${t.id}`,children:t.isSystemMessage?e.jsx("div",{className:"px-4 py-2 bg-gray-700/50 rounded-full text-xs text-gray-400 italic",children:t.message}):e.jsxs("div",{className:"flex flex-col max-w-[75%]",children:[t.senderId!==p?.id&&e.jsx("span",{className:"text-xs text-purple-400 mb-1 ml-1 font-medium",children:u?"Seller":"Buyer"}),e.jsxs("div",{className:`p-3 rounded-xl ${t.senderId===p?.id?"bg-purple-600 text-white rounded-br-sm":"bg-gray-700 text-white rounded-bl-sm"}`,children:[t.fileUrl&&e.jsx("div",{className:"mb-2",children:ke(t.fileUrl)?e.jsx("a",{href:t.fileUrl,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:t.fileUrl,alt:"Attachment",className:"max-w-full max-h-48 rounded-lg cursor-pointer hover:opacity-90 transition-opacity"})}):e.jsxs("a",{href:t.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-gray-600/50 rounded-lg hover:bg-gray-600/70 transition-colors",children:[(()=>{const a=Ne(t.fileUrl);return e.jsx(a,{className:"h-5 w-5"})})(),e.jsx("span",{className:"text-sm underline truncate max-w-[200px]",children:t.message.replace("ðŸ“Ž Attached file: ","")})]})}),!t.fileUrl&&e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.message}),e.jsx("p",{className:`text-xs mt-1 ${t.senderId===p?.id?"text-purple-200":"text-gray-400"}`,children:new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},t.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ue,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No messages yet. Start the conversation!"})]}),e.jsx("div",{ref:W})]}),e.jsx("input",{type:"file",ref:H,onChange:ve,className:"hidden",accept:"image/*,.pdf,.doc,.docx,.xlsx,.xls,.csv,.mp4,.mov,.avi,.webm"}),e.jsxs("form",{onSubmit:Ce,className:"flex gap-2 items-center",children:[e.jsx(n,{type:"button",variant:"ghost",size:"icon",className:"text-gray-400 hover:text-white hover:bg-gray-700",onClick:()=>H.current?.click(),disabled:ee.isPending,"data-testid":"button-attach-file",children:e.jsx(We,{className:"h-5 w-5"})}),e.jsx(le,{placeholder:"Type a message...",className:"flex-1 bg-gray-800 border-gray-700 text-white",value:x,onChange:t=>V(t.target.value),"data-testid":"input-chat-message"}),e.jsx(n,{type:"submit",className:"bg-purple-600 hover:bg-purple-700",disabled:!x.trim()||Z.isPending,"data-testid":"button-send-message",children:e.jsx(_e,{className:"h-4 w-4"})})]})]})]}),e.jsx(L,{open:fe,onOpenChange:b,children:e.jsxs(R,{className:"bg-gray-900 border-gray-800",children:[e.jsxs(K,{children:[e.jsxs(_,{className:"text-white flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5 text-orange-400"}),"Open Dispute"]}),e.jsx(Q,{className:"text-gray-400",children:"Please describe the issue with this transaction. Be as detailed as possible to help the dispute admin resolve your case."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"text-gray-300",children:"Reason for dispute"}),e.jsx(de,{placeholder:"Describe the issue (e.g., seller hasn't delivered, wrong product received, payment not received...)",className:"bg-gray-800 border-gray-700 text-white min-h-[120px]",value:D,onChange:t=>P(t.target.value),"data-testid":"input-dispute-reason"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"outline",className:"flex-1 border-gray-700",onClick:()=>{b(!1),P("")},"data-testid":"button-cancel-dispute",children:"Cancel"}),e.jsx(n,{className:"flex-1 bg-orange-600 hover:bg-orange-700",onClick:()=>N.mutate(D),disabled:!D.trim()||N.isPending,"data-testid":"button-submit-dispute",children:N.isPending?"Opening...":"Open Dispute"})]})]})]})}),e.jsx(L,{open:xe,onOpenChange:f,children:e.jsxs(R,{className:"bg-gray-900 border-gray-800",children:[e.jsxs(K,{children:[e.jsxs(_,{className:"text-white flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5 text-purple-400"}),"Authenticator Code Required"]}),e.jsx(Q,{className:"text-gray-400",children:"Enter the 6-digit code from your authenticator app to confirm delivery and release payment. This ensures you authorized this transaction."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(le,{type:"text",placeholder:"Enter 6-digit code",className:"bg-gray-800 border-gray-700 text-white text-center text-lg tracking-widest",value:C,onChange:t=>y(t.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,"data-testid":"input-2fa-code"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"outline",className:"flex-1 border-gray-700",onClick:()=>{f(!1),y("")},"data-testid":"button-cancel-2fa",children:"Cancel"}),e.jsx(n,{className:"flex-1 bg-green-600 hover:bg-green-700",onClick:()=>h.mutate(C),disabled:C.length!==6||h.isPending,"data-testid":"button-submit-2fa",children:h.isPending?"Confirming...":"Confirm & Release"})]})]})]})}),e.jsx(L,{open:be,onOpenChange:w,children:e.jsxs(R,{className:"bg-gray-900 border-gray-800",children:[e.jsxs(K,{children:[e.jsxs(_,{className:"text-white flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-yellow-400"}),"Leave Feedback"]}),e.jsx(Q,{className:"text-gray-400",children:"Rate your experience with this trade. Your feedback helps build trust in the marketplace."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"text-gray-300",children:"Rating"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(t=>e.jsx(n,{type:"button",variant:"ghost",size:"icon",className:`${A>=t?"text-yellow-400":"text-gray-600"} hover:text-yellow-400`,onClick:()=>O(t),"data-testid":`button-star-${t}`,children:e.jsx(J,{className:`h-6 w-6 ${A>=t?"fill-yellow-400":""}`})},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"text-gray-300",children:"Comment (optional)"}),e.jsx(de,{placeholder:"Share your experience...",className:"bg-gray-800 border-gray-700 text-white min-h-[100px]",value:X,onChange:t=>E(t.target.value),"data-testid":"input-feedback-comment"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"outline",className:"flex-1 border-gray-700",onClick:()=>{w(!1),O(5),E("")},"data-testid":"button-cancel-feedback",children:"Cancel"}),e.jsx(n,{className:"flex-1 bg-yellow-600 hover:bg-yellow-700",onClick:()=>q.mutate({stars:A,comment:X}),disabled:q.isPending,"data-testid":"button-submit-feedback",children:q.isPending?"Submitting...":"Submit Feedback"})]})]})]})})]})})}export{At as default};
