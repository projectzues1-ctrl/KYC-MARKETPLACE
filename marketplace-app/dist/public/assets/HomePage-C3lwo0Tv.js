import{c as J,r as v,u as Te,a as $,i as P,j as e,X as De,S as $e,f as w,g as ie,b as ge,d as Ze,L as O}from"./index-B6hPo9fH.js";import{B as M}from"./button-DdYfvWb9.js";import{B as X}from"./badge-Dn4EaI7W.js";import{T as Ge,S as we}from"./ThemeToggle-Cd9vwdUm.js";import{u as F}from"./useMutation-C_3TpXjp.js";import{T as pe}from"./textarea-Cc28xWq-.js";import{I}from"./input-vnQcFn7U.js";import{S as et}from"./scroll-area-DqP6ku2v.js";import{D as Le,a as qe,b as _e,c as Ue}from"./dialog-D_lwzFP4.js";import{u as Ee}from"./useTranslation-O3_Fa0eH.js";import{S as je}from"./search-BRMhtFmq.js";import{S as ke,M as H}from"./send-DvM8hF-_.js";import{B as de}from"./badge-check-D3unhvu5.js";import{L as K}from"./loader-circle-bHqV6n7f.js";import{T as Oe}from"./trash-2-DycntUct.js";import{T as We,C as tt}from"./thumbs-down-DKyiOy3F.js";import{L as W}from"./label-B38SsxLd.js";import{C as st}from"./checkbox-BZSYmHI3.js";import{C as te,a as se,b as at,c as nt,d as rt}from"./card-Cl1MO1GN.js";import{T as ot,a as it,b as ue,c as he}from"./tabs-YN5y1_yR.js";import{S as dt,a as lt,b as ct,c as mt,d as xe}from"./select-_UnfLIee.js";import{L as Se}from"./lock-67rVn5Zl.js";import{S as Ie}from"./shield-DVigj7cn.js";import{T as Ke}from"./thumbs-up-CkiQKVSZ.js";import{C as ne}from"./clock-BbwHj01_.js";import{D as ut}from"./dollar-sign-pMvEizJe.js";import{P as Ce}from"./plus-DWkselk7.js";import{C as Me}from"./circle-alert-LzkFmbap.js";import{U as Re}from"./index-Dt-oTuiC.js";import{C as ht}from"./chevron-left-DsaiS75a.js";import{B as xt,H as ft,S as pt,a as gt}from"./shopping-cart-DT7LSJeM.js";import"./index-BdQq_4o_.js";import"./index-D8nDhomm.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],bt=J("arrow-up-down",jt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],vt=J("funnel",yt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],wt=J("heart",Nt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],St=J("megaphone",kt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=[["path",{d:"M4 11a9 9 0 0 1 9 9",key:"pv89mb"}],["path",{d:"M4 4a16 16 0 0 1 16 16",key:"k0647b"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]],Mt=J("rss",Ct);function k(t){const a=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&a==="[object Date]"?new t.constructor(+t):typeof t=="number"||a==="[object Number]"||typeof t=="string"||a==="[object String]"?new Date(t):new Date(NaN)}function Pt(t,a){return t instanceof Date?new t.constructor(a):new Date(a)}const ae=43200,Pe=1440;let At={};function Ft(){return At}function Ae(t){const a=k(t),n=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return n.setUTCFullYear(a.getFullYear()),+t-+n}function re(t,a){const n=k(t),r=k(a),o=n.getTime()-r.getTime();return o<0?-1:o>0?1:o}function Tt(t){return Pt(t,Date.now())}function Dt(t,a){const n=k(t),r=k(a),o=n.getFullYear()-r.getFullYear(),l=n.getMonth()-r.getMonth();return o*12+l}function $t(t){return a=>{const r=(t?Math[t]:Math.trunc)(a);return r===0?0:r}}function Lt(t,a){return+k(t)-+k(a)}function qt(t){const a=k(t);return a.setHours(23,59,59,999),a}function _t(t){const a=k(t),n=a.getMonth();return a.setFullYear(a.getFullYear(),n+1,0),a.setHours(23,59,59,999),a}function Ut(t){const a=k(t);return+qt(a)==+_t(a)}function Et(t,a){const n=k(t),r=k(a),o=re(n,r),l=Math.abs(Dt(n,r));let m;if(l<1)m=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-o*l);let d=re(n,r)===-o;Ut(k(t))&&l===1&&re(t,r)===1&&(d=!1),m=o*(l-Number(d))}return m===0?0:m}function Ot(t,a,n){const r=Lt(t,a)/1e3;return $t(n?.roundingMethod)(r)}const Wt={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},It=(t,a,n)=>{let r;const o=Wt[t];return typeof o=="string"?r=o:a===1?r=o.one:r=o.other.replace("{{count}}",a.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function fe(t){return(a={})=>{const n=a.width?String(a.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const Kt={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Rt={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Qt={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Vt={date:fe({formats:Kt,defaultWidth:"full"}),time:fe({formats:Rt,defaultWidth:"full"}),dateTime:fe({formats:Qt,defaultWidth:"full"})},zt={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Bt=(t,a,n,r)=>zt[t];function B(t){return(a,n)=>{const r=n?.context?String(n.context):"standalone";let o;if(r==="formatting"&&t.formattingValues){const m=t.defaultFormattingWidth||t.defaultWidth,d=n?.width?String(n.width):m;o=t.formattingValues[d]||t.formattingValues[m]}else{const m=t.defaultWidth,d=n?.width?String(n.width):t.defaultWidth;o=t.values[d]||t.values[m]}const l=t.argumentCallback?t.argumentCallback(a):a;return o[l]}}const Yt={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Xt={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Ht={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Jt={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Zt={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Gt={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},es=(t,a)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},ts={ordinalNumber:es,era:B({values:Yt,defaultWidth:"wide"}),quarter:B({values:Xt,defaultWidth:"wide",argumentCallback:t=>t-1}),month:B({values:Ht,defaultWidth:"wide"}),day:B({values:Jt,defaultWidth:"wide"}),dayPeriod:B({values:Zt,defaultWidth:"wide",formattingValues:Gt,defaultFormattingWidth:"wide"})};function Y(t){return(a,n={})=>{const r=n.width,o=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],l=a.match(o);if(!l)return null;const m=l[0],d=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],g=Array.isArray(d)?as(d,h=>h.test(m)):ss(d,h=>h.test(m));let x;x=t.valueCallback?t.valueCallback(g):g,x=n.valueCallback?n.valueCallback(x):x;const N=a.slice(m.length);return{value:x,rest:N}}}function ss(t,a){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&a(t[n]))return n}function as(t,a){for(let n=0;n<t.length;n++)if(a(t[n]))return n}function ns(t){return(a,n={})=>{const r=a.match(t.matchPattern);if(!r)return null;const o=r[0],l=a.match(t.parsePattern);if(!l)return null;let m=t.valueCallback?t.valueCallback(l[0]):l[0];m=n.valueCallback?n.valueCallback(m):m;const d=a.slice(o.length);return{value:m,rest:d}}}const rs=/^(\d+)(th|st|nd|rd)?/i,os=/\d+/i,is={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ds={any:[/^b/i,/^(a|c)/i]},ls={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},cs={any:[/1/i,/2/i,/3/i,/4/i]},ms={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},us={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},hs={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},xs={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},fs={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ps={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},gs={ordinalNumber:ns({matchPattern:rs,parsePattern:os,valueCallback:t=>parseInt(t,10)}),era:Y({matchPatterns:is,defaultMatchWidth:"wide",parsePatterns:ds,defaultParseWidth:"any"}),quarter:Y({matchPatterns:ls,defaultMatchWidth:"wide",parsePatterns:cs,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Y({matchPatterns:ms,defaultMatchWidth:"wide",parsePatterns:us,defaultParseWidth:"any"}),day:Y({matchPatterns:hs,defaultMatchWidth:"wide",parsePatterns:xs,defaultParseWidth:"any"}),dayPeriod:Y({matchPatterns:fs,defaultMatchWidth:"any",parsePatterns:ps,defaultParseWidth:"any"})},js={code:"en-US",formatDistance:It,formatLong:Vt,formatRelative:Bt,localize:ts,match:gs,options:{weekStartsOn:0,firstWeekContainsDate:1}};function bs(t,a,n){const r=Ft(),o=n?.locale??r.locale??js,l=2520,m=re(t,a);if(isNaN(m))throw new RangeError("Invalid time value");const d=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:m});let g,x;m>0?(g=k(a),x=k(t)):(g=k(t),x=k(a));const N=Ot(x,g),h=(Ae(x)-Ae(g))/1e3,u=Math.round((N-h)/60);let S;if(u<2)return n?.includeSeconds?N<5?o.formatDistance("lessThanXSeconds",5,d):N<10?o.formatDistance("lessThanXSeconds",10,d):N<20?o.formatDistance("lessThanXSeconds",20,d):N<40?o.formatDistance("halfAMinute",0,d):N<60?o.formatDistance("lessThanXMinutes",1,d):o.formatDistance("xMinutes",1,d):u===0?o.formatDistance("lessThanXMinutes",1,d):o.formatDistance("xMinutes",u,d);if(u<45)return o.formatDistance("xMinutes",u,d);if(u<90)return o.formatDistance("aboutXHours",1,d);if(u<Pe){const y=Math.round(u/60);return o.formatDistance("aboutXHours",y,d)}else{if(u<l)return o.formatDistance("xDays",1,d);if(u<ae){const y=Math.round(u/Pe);return o.formatDistance("xDays",y,d)}else if(u<ae*2)return S=Math.round(u/ae),o.formatDistance("aboutXMonths",S,d)}if(S=Et(x,g),S<12){const y=Math.round(u/ae);return o.formatDistance("xMonths",y,d)}else{const y=S%12,T=Math.trunc(S/12);return y<3?o.formatDistance("aboutXYears",T,d):y<9?o.formatDistance("overXYears",T,d):o.formatDistance("almostXYears",T+1,d)}}function Qe(t,a){return bs(t,Tt(t),a)}function oe(t){const a=/@(\w+)/g;return t.split(a).map((r,o)=>o%2===1?e.jsxs("span",{className:"text-primary font-medium",children:["@",r]},o):r)}function ys({author:t}){return t.profilePicture?e.jsx("img",{src:t.profilePicture,alt:t.username,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary to-primary/60 rounded-full flex items-center justify-center text-primary-foreground font-bold",children:t.username&&t.username.length>0?t.username[0].toUpperCase():"U"})}function Ve({author:t}){return t.profilePicture?e.jsx("img",{src:t.profilePicture,alt:t.username,className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary to-primary/60 rounded-full flex items-center justify-center text-primary-foreground text-sm font-bold",children:t.username&&t.username.length>0?t.username[0].toUpperCase():"U"})}function vs({post:t,onLike:a,onUnlike:n,onDislike:r,onUndislike:o,onDelete:l,onComment:m,isLiked:d,isDisliked:g}){const x=ie(),[,N]=ge(),h=x?.id===t.authorId,u=x?.role==="admin",S=h||u;return e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4 space-y-3","data-testid":`post-card-${t.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("button",{className:"flex items-center gap-2 hover:opacity-80 transition-opacity text-left flex-1",onClick:()=>N(`/profile?id=${t.author.id}`),"data-testid":`profile-link-${t.author.id}`,children:[e.jsx(ys,{author:t.author}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.author.username}),t.author.isVerifiedVendor&&e.jsx(de,{className:"h-4 w-4 text-primary","data-testid":`verified-badge-${t.id}`})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Qe(new Date(t.createdAt),{addSuffix:!0})})]})]}),S&&e.jsx(M,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:l,"data-testid":`delete-post-${t.id}`,children:e.jsx(Oe,{className:"h-4 w-4"})})]}),t.originalPostId&&t.quoteText&&e.jsx("div",{className:"bg-muted/50 rounded-md p-3 border-l-2 border-primary",children:e.jsx("p",{className:"text-sm text-muted-foreground italic",children:oe(t.quoteText)})}),e.jsx("p",{className:"text-foreground whitespace-pre-wrap",children:oe(t.content)}),e.jsxs("div",{className:"flex items-center gap-4 pt-2 border-t border-border",children:[e.jsxs("button",{className:`flex items-center gap-1.5 text-sm transition-colors ${d?"text-red-500":"text-muted-foreground hover:text-red-500"}`,onClick:d?n:a,disabled:!P(),"data-testid":`like-btn-${t.id}`,children:[e.jsx(wt,{className:`h-4 w-4 ${d?"fill-current":""}`}),e.jsx("span",{children:t.likesCount})]}),e.jsxs("button",{className:`flex items-center gap-1.5 text-sm transition-colors ${g?"text-blue-500":"text-muted-foreground hover:text-blue-500"}`,onClick:g?o:r,disabled:!P(),"data-testid":`dislike-btn-${t.id}`,children:[e.jsx(We,{className:`h-4 w-4 ${g?"fill-current":""}`}),e.jsx("span",{children:t.dislikesCount})]}),e.jsxs("button",{className:"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground transition-colors",onClick:m,"data-testid":`comment-btn-${t.id}`,children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:t.commentsCount})]})]})]})}function Ns({comment:t,onDelete:a}){const n=ie(),r=n?.id===t.authorId,o=n?.role==="admin",l=r||o;return e.jsxs("div",{className:"group flex gap-3 p-3 rounded-lg hover:bg-muted/40 transition-colors border-b border-border/50 last:border-0","data-testid":`comment-${t.id}`,children:[e.jsx(Ve,{author:t.author}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-semibold text-sm text-foreground",children:t.author.username}),t.author.isVerifiedVendor&&e.jsx(de,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Qe(new Date(t.createdAt),{addSuffix:!0})})]}),l&&e.jsx(M,{variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition-all",onClick:a,"data-testid":`delete-comment-${t.id}`,children:e.jsx(Oe,{className:"h-3.5 w-3.5"})})]}),e.jsx("p",{className:"text-sm text-foreground mt-1.5 leading-relaxed",children:oe(t.content)})]})]})}function ws(){const{t}=Ee(),[a,n]=v.useState(""),[r,o]=v.useState(null),[l,m]=v.useState(""),[d,g]=v.useState(""),[x,N]=v.useState(""),h=Te(),{data:u,isLoading:S}=$({queryKey:["socialPosts",x],queryFn:async()=>{const i=new URLSearchParams;return x&&i.set("search",x),(await fetch(`/api/social/posts?${i.toString()}`)).json()}}),{data:y}=$({queryKey:["likedPosts"],queryFn:async()=>{if(!P()||!u)return{};const i={};for(const j of u){const A=await(await w(`/api/social/posts/${j.id}/liked`)).json();i[j.id]=A.liked}return i},enabled:P()&&!!u}),{data:T}=$({queryKey:["dislikedPosts"],queryFn:async()=>{if(!P()||!u)return{};const i={};for(const j of u){const A=await(await w(`/api/social/posts/${j.id}/disliked`)).json();i[j.id]=A.disliked}return i},enabled:P()&&!!u}),{data:L}=$({queryKey:["postComments",r?.id],queryFn:async()=>r?(await fetch(`/api/social/posts/${r.id}/comments`)).json():[],enabled:!!r}),q=F({mutationFn:async i=>{const j=await w("/api/social/posts",{method:"POST",body:JSON.stringify(i)});if(!j.ok){const D=await j.json();throw new Error(D.message)}return j.json()},onSuccess:()=>{n(""),h.invalidateQueries({queryKey:["socialPosts"]})}}),R=F({mutationFn:async i=>{if(!(await w(`/api/social/posts/${i}`,{method:"DELETE"})).ok)throw new Error("Failed to delete post")},onSuccess:()=>{h.invalidateQueries({queryKey:["socialPosts"]})}}),f=F({mutationFn:async i=>(await w(`/api/social/posts/${i}/like`,{method:"POST"})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["socialPosts"]}),h.invalidateQueries({queryKey:["likedPosts"]})}}),C=F({mutationFn:async i=>(await w(`/api/social/posts/${i}/like`,{method:"DELETE"})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["socialPosts"]}),h.invalidateQueries({queryKey:["likedPosts"]})}}),p=F({mutationFn:async i=>(await w(`/api/social/posts/${i}/dislike`,{method:"POST"})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["socialPosts"]}),h.invalidateQueries({queryKey:["dislikedPosts"]})}}),Q=F({mutationFn:async i=>(await w(`/api/social/posts/${i}/dislike`,{method:"DELETE"})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["socialPosts"]}),h.invalidateQueries({queryKey:["dislikedPosts"]})}}),_=F({mutationFn:async({postId:i,content:j})=>{const D=await w(`/api/social/posts/${i}/comments`,{method:"POST",body:JSON.stringify({content:j})});if(!D.ok){const A=await D.json();throw new Error(A.message)}return D.json()},onSuccess:()=>{m(""),h.invalidateQueries({queryKey:["postComments",r?.id]}),h.invalidateQueries({queryKey:["socialPosts"]})}}),U=F({mutationFn:async i=>{if(!(await w(`/api/social/comments/${i}`,{method:"DELETE"})).ok)throw new Error("Failed to delete comment")},onSuccess:()=>{h.invalidateQueries({queryKey:["postComments",r?.id]}),h.invalidateQueries({queryKey:["socialPosts"]})}}),le=()=>{a.trim()&&q.mutate({content:a})},V=()=>{!l.trim()||!r||_.mutate({postId:r.id,content:l})},E=()=>{N(d)},Z=()=>{g(""),N("")};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2","data-testid":"search-bar",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(I,{placeholder:t("feed.searchPlaceholder"),value:d,onChange:i=>g(i.target.value),onKeyDown:i=>i.key==="Enter"&&E(),className:"pl-10 pr-10","data-testid":"search-input"}),d&&e.jsx("button",{onClick:Z,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground","data-testid":"clear-search-btn",children:e.jsx(De,{className:"h-4 w-4"})})]}),e.jsx(M,{onClick:E,"data-testid":"search-btn",children:t("common.search")})]}),x&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[t("feed.showingResults"),' "',x,'"']}),e.jsx("button",{onClick:Z,className:"text-primary hover:underline",children:t("feed.clear")})]}),P()&&e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4","data-testid":"create-post-form",children:[e.jsx(pe,{placeholder:t("feed.whatsOnYourMind"),value:a,onChange:i=>n(i.target.value),maxLength:800,className:"min-h-[80px] resize-none","data-testid":"post-input"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.length,"/800"]}),e.jsxs(M,{onClick:le,disabled:!a.trim()||q.isPending,size:"sm","data-testid":"submit-post-btn",children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),t("feed.post")]})]})]}),S?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(i=>e.jsx($e,{className:"h-40 rounded-lg"},i))}):u&&u.length>0?e.jsx("div",{className:"space-y-4",children:u.map(i=>e.jsx(vs,{post:i,isLiked:y?.[i.id]||!1,isDisliked:T?.[i.id]||!1,onLike:()=>f.mutate(i.id),onUnlike:()=>C.mutate(i.id),onDislike:()=>p.mutate(i.id),onUndislike:()=>Q.mutate(i.id),onDelete:()=>R.mutate(i.id),onComment:()=>o(i)},i.id))}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(H,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:t("feed.noPostsYet")}),e.jsx("p",{className:"text-sm",children:t("feed.beFirstToPost")})]}),e.jsx(Le,{open:!!r,onOpenChange:()=>o(null),children:e.jsxs(qe,{className:"max-w-lg max-h-[85vh] flex flex-col p-0 gap-0",children:[e.jsx(_e,{className:"px-6 py-4 border-b",children:e.jsxs(Ue,{className:"flex items-center gap-2 text-lg",children:[e.jsx(H,{className:"h-5 w-5 text-primary"}),t("feed.comments")]})}),r&&e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 bg-gradient-to-br from-muted/30 to-muted/10 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ve,{author:r.author}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-semibold text-sm",children:r.author.username}),r.author.isVerifiedVendor&&e.jsx(de,{className:"h-4 w-4 text-primary"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("feed.originalPost")})]})]}),e.jsx("p",{className:"text-sm leading-relaxed",children:oe(r.content)})]}),e.jsx(et,{className:"flex-1 px-3",children:e.jsx("div",{className:"py-2",children:L&&L.length>0?e.jsx("div",{className:"space-y-1",children:L.map(i=>e.jsx(Ns,{comment:i,onDelete:()=>U.mutate(i.id)},i.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(H,{className:"h-10 w-10 text-muted-foreground/30 mb-3"}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t("feed.noComments")}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1",children:t("feed.beFirstToComment")})]})})}),P()&&e.jsx("div",{className:"px-6 py-4 border-t bg-muted/20",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(pe,{placeholder:t("feed.shareYourThoughts"),value:l,onChange:i=>m(i.target.value),maxLength:500,className:"min-h-[80px] resize-none flex-1 bg-background border-muted-foreground/20 focus:border-primary","data-testid":"comment-input"}),e.jsxs("div",{className:"flex flex-col justify-end gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground text-right",children:[l.length,"/500"]}),e.jsxs(M,{onClick:V,disabled:!l.trim()||_.isPending,size:"default",className:"gap-2","data-testid":"submit-comment-btn",children:[_.isPending?e.jsx(K,{className:"h-4 w-4 animate-spin"}):e.jsx(ke,{className:"h-4 w-4"}),"Post"]})]})]})})]})]})})]})}const Fe=[{value:"15min",label:"15 minutes"},{value:"30min",label:"30 minutes"},{value:"1hr",label:"1 hour"},{value:"2hr",label:"2 hours"}];function ks(){const[,t]=ge(),{toast:a}=Ze(),n=Te(),[r,o]=v.useState("active"),[l,m]=v.useState(""),[d,g]=v.useState(""),[x,N]=v.useState(""),[h,u]=v.useState("30min"),[S,y]=v.useState(""),[T,L]=v.useState(!1),[q,R]=v.useState(""),[f,C]=v.useState("default"),p=s=>{if(s===""){m("");return}if(!/^\d+(\.\d{0,8})?$/.test(s))return;const c=parseFloat(s);!isNaN(c)&&c>=1&&m(s)},Q=s=>{if(s===""){N("");return}if(!/^\d+$/.test(s))return;const c=parseInt(s);!isNaN(c)&&c>=0&&c<=100&&N(s)},{data:_}=$({queryKey:["wallet"],queryFn:async()=>(await w("/api/wallet")).json(),enabled:P()}),{data:U,isLoading:le}=$({queryKey:["loaderAds"],queryFn:async()=>{const s=await fetch("/api/loaders/ads"),c=await s.json();return!s.ok||!Array.isArray(c)?[]:c},enabled:r==="active"}),{data:V}=$({queryKey:["myLoaderAds"],queryFn:async()=>{const s=await w("/api/loaders/my-ads"),c=await s.json();return!s.ok||!Array.isArray(c)?[]:c},enabled:P()&&r==="post"}),{data:E,isLoading:Z}=$({queryKey:["myLoaderOrders"],queryFn:async()=>{const s=await w("/api/loaders/my-orders"),c=await s.json();return!s.ok||!Array.isArray(c)?[]:c},enabled:P()&&r==="orders"}),i=F({mutationFn:async()=>{const s=S.split(",").map(b=>b.trim()).filter(b=>b.length>0),c=await w("/api/loaders/ads",{method:"POST",body:JSON.stringify({assetType:"USD",dealAmount:parseFloat(l),loadingTerms:d,upfrontPercentage:x?parseInt(x):0,countdownTime:h,paymentMethods:s})});if(!c.ok){const b=await c.json();throw new Error(b.message)}return c.json()},onSuccess:()=>{a({title:"Success",description:"Loading ad posted successfully!"}),n.invalidateQueries({queryKey:["loaderAds"]}),n.invalidateQueries({queryKey:["myLoaderAds"]}),n.invalidateQueries({queryKey:["wallet"]}),m(""),g(""),N(""),u("30min"),y(""),L(!1),o("active")},onError:s=>{a({variant:"destructive",title:"Error",description:s.message})}}),j=F({mutationFn:async s=>{const c=await w(`/api/loaders/ads/${s}/accept`,{method:"POST"});if(!c.ok){const b=await c.json();throw new Error(b.message)}return c.json()},onSuccess:s=>{a({title:"Deal Accepted",description:"Redirecting to order..."}),n.invalidateQueries({queryKey:["loaderAds"]}),n.invalidateQueries({queryKey:["wallet"]}),t(`/loader-order/${s.id}`)},onError:s=>{a({variant:"destructive",title:"Error",description:s.message})}}),D=F({mutationFn:async s=>{const c=await w(`/api/loaders/ads/${s}`,{method:"DELETE"});if(!c.ok){const b=await c.json();throw new Error(b.message)}return c.json()},onSuccess:()=>{a({title:"Success",description:"Ad cancelled and funds refunded"}),n.invalidateQueries({queryKey:["myLoaderAds"]}),n.invalidateQueries({queryKey:["loaderAds"]}),n.invalidateQueries({queryKey:["wallet"]})},onError:s=>{a({variant:"destructive",title:"Error",description:s.message})}}),A=parseFloat(l||"0"),be=A*.1,ye=A*.03,G=be+ye,ce=parseFloat(_?.availableBalance||"0"),z=parseInt(x)||0,ve=A*z/100,Ne=z<50&&A>0,ze=z>=10,Be=l&&A>=1&&S.trim().length>0&&ce>=G&&ze&&(!Ne||T),me=v.useMemo(()=>{if(!U)return[];let s=U.filter(c=>{if(!q.trim())return!0;const b=q.toLowerCase(),Xe=c.loaderUsername?.toLowerCase().includes(b),He=c.paymentMethods.some(Je=>Je.toLowerCase().includes(b));return Xe||He});return f==="high_to_low"?s=[...s].sort((c,b)=>parseFloat(b.dealAmount)-parseFloat(c.dealAmount)):f==="low_to_high"&&(s=[...s].sort((c,b)=>parseFloat(c.dealAmount)-parseFloat(b.dealAmount))),s},[U,q,f]),ee=s=>{if(!s)return null;const c=s.positiveFeedback+s.negativeFeedback;return c===0?null:Math.round(s.positiveFeedback/c*100)},Ye=s=>{const b={awaiting_liability_confirmation:{label:"Select Terms",variant:"outline"},awaiting_payment_details:{label:"Awaiting Details",variant:"outline"},payment_details_sent:{label:"Details Sent",variant:"default"},payment_sent:{label:"Payment Sent",variant:"default"},asset_frozen_waiting:{label:"Frozen - Waiting",variant:"secondary"},completed:{label:"Completed",variant:"default"},closed_no_payment:{label:"Closed",variant:"secondary"},cancelled_auto:{label:"Auto-Cancelled",variant:"secondary"},cancelled_loader:{label:"Cancelled by Loader",variant:"destructive"},cancelled_receiver:{label:"Cancelled by Receiver",variant:"destructive"},disputed:{label:"Disputed",variant:"destructive"},resolved_loader_wins:{label:"Resolved - Loader Wins",variant:"default"},resolved_receiver_wins:{label:"Resolved - Receiver Wins",variant:"default"},resolved_mutual:{label:"Resolved - Mutual",variant:"secondary"}}[s]||{label:s.replace(/_/g," "),variant:"secondary"};return e.jsx(X,{variant:b.variant,"data-testid":`status-badge-${s}`,children:b.label})};return P()?e.jsxs("div",{className:"px-4 pb-24",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2","data-testid":"text-loaders-title",children:[e.jsx(Ie,{className:"h-6 w-6 text-primary"}),"Loaders Zone"]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"High-trust loading with escrow protection"})]}),e.jsxs(ot,{value:r,onValueChange:o,className:"w-full",children:[e.jsxs(it,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsx(ue,{value:"active","data-testid":"tab-active-ads",children:"Active Ads"}),e.jsx(ue,{value:"post","data-testid":"tab-post-ad",children:"Post Ad"}),e.jsx(ue,{value:"orders","data-testid":"tab-my-orders",children:"My Orders"})]}),e.jsxs(he,{value:"active",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search by username or payment method...",value:q,onChange:s=>R(s.target.value),className:"pl-10","data-testid":"input-search-ads"})]}),e.jsxs(dt,{value:f,onValueChange:s=>C(s),children:[e.jsxs(lt,{className:"w-full sm:w-48","data-testid":"select-sort",children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),e.jsx(ct,{placeholder:"Sort by amount"})]}),e.jsxs(mt,{children:[e.jsx(xe,{value:"default",children:"Default"}),e.jsx(xe,{value:"high_to_low",children:"Amount: High to Low"}),e.jsx(xe,{value:"low_to_high",children:"Amount: Low to High"})]})]})]}),le?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):me&&me.length>0?me.map(s=>e.jsx(te,{className:"overflow-hidden","data-testid":`card-ad-${s.id}`,children:e.jsxs(se,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>t(`/profile?id=${s.loaderId}`),className:"flex items-center gap-2 hover:opacity-80 transition-opacity","data-testid":`profile-link-loader-${s.loaderId}`,children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0",children:(s.loaderUsername||"L")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"font-medium text-foreground","data-testid":`text-loader-${s.id}`,children:s.loaderUsername||"Loader"}),s.loaderStats?.isVerifiedVendor&&e.jsx(de,{className:"h-4 w-4 text-blue-500","data-testid":`verified-badge-${s.id}`})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[s.loaderStats?.completedTrades||0," trades"]}),ee(s.loaderStats)!==null&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:ee(s.loaderStats)>=80?"text-green-600":ee(s.loaderStats)>=50?"text-yellow-600":"text-red-600",children:[ee(s.loaderStats),"% trust"]}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(Ke,{className:"h-3 w-3 text-green-600"}),s.loaderStats?.positiveFeedback||0]}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(We,{className:"h-3 w-3 text-red-600"}),s.loaderStats?.negativeFeedback||0]})]})]})]})]})}),e.jsxs(X,{variant:"outline",className:"flex items-center gap-1 text-green-600 border-green-600",children:[e.jsx(Se,{className:"h-3 w-3"}),"10% Locked"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Asset Type"}),e.jsx("p",{className:"font-semibold text-foreground",children:s.assetType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Deal Amount"}),e.jsxs("p",{className:"font-semibold text-foreground",children:["$",parseFloat(s.dealAmount).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Countdown"}),e.jsxs("p",{className:"font-semibold text-foreground flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3"}),Fe.find(c=>c.value===s.countdownTime)?.label||"30 minutes"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receiver Fee"}),e.jsxs("p",{className:"font-semibold text-foreground",children:["2% ($",(parseFloat(s.dealAmount)*.02).toFixed(2),")"]})]})]}),s.loadingTerms&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Loading Terms"}),e.jsx("p",{className:"text-sm text-foreground",children:s.loadingTerms})]}),s.upfrontPercentage&&s.upfrontPercentage>0&&e.jsx("div",{className:"mb-3 p-2 bg-amber-500/10 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-600",children:["Requires ",s.upfrontPercentage,"% upfront ($",(parseFloat(s.dealAmount)*s.upfrontPercentage/100).toFixed(2),")"]})}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:s.paymentMethods.map((c,b)=>e.jsx(X,{variant:"secondary",className:"text-xs",children:c},b))}),e.jsxs(M,{className:"w-full",onClick:()=>j.mutate(s.id),disabled:j.isPending||s.loaderId===ie()?.id,"data-testid":`button-accept-${s.id}`,children:[j.isPending?e.jsx(K,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Accept Deal"]})]})},s.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ut,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No active loading ads"}),e.jsx(M,{variant:"outline",className:"mt-4",onClick:()=>o("post"),"data-testid":"button-post-first",children:"Post the first ad"})]})]}),e.jsx(he,{value:"post",children:e.jsxs(te,{children:[e.jsxs(at,{children:[e.jsxs(nt,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Post Loading Ad"]}),e.jsx(rt,{children:"Create a new loading offer with escrow protection"})]}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"assetType",children:"Asset Type"}),e.jsx(I,{id:"assetType",value:"USD",disabled:!0,className:"bg-muted","data-testid":"input-asset-type"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Fixed to USD"})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"dealAmount",children:"Deal Amount"}),e.jsx(I,{id:"dealAmount",type:"number",min:"0",value:l,onChange:s=>p(s.target.value),placeholder:"Enter amount","data-testid":"input-deal-amount"}),l&&parseFloat(l)>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["10% commitment: $",(parseFloat(l)*.1).toFixed(2)," + 3% fee: $",(parseFloat(l)*.03).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"loadingTerms",children:"Loading Rate / Terms (max 200 chars)"}),e.jsx(pe,{id:"loadingTerms",value:d,onChange:s=>g(s.target.value.slice(0,200)),placeholder:"Describe your loading terms...",maxLength:200,"data-testid":"input-loading-terms"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[d.length,"/200"]})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"upfront",children:"Receiver Upfront Requirement (%)"}),e.jsx(I,{id:"upfront",type:"number",min:"0",max:"100",value:x,onChange:s=>{Q(s.target.value),L(!1)},placeholder:"0-100","data-testid":"input-upfront"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter 0-100%. Leave empty or set 0 if no upfront is required from receiver"})]}),Ne&&e.jsx("div",{className:"p-3 bg-amber-500/10 rounded-lg border border-amber-500/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Me,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-700",children:"Low Upfront Warning"}),e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["You are setting the upfront requirement to ",e.jsxs("strong",{children:[z,"%"]})," ($",ve.toFixed(2)," of $",A.toFixed(2),").",z===0?" This means the receiver pays nothing upfront.":" This is below 50% of the deal amount."]}),e.jsxs("label",{className:"flex items-start gap-2 mt-3 cursor-pointer",children:[e.jsx(st,{checked:T,onCheckedChange:s=>L(s===!0),"data-testid":"checkbox-low-upfront"}),e.jsxs("span",{className:"text-xs text-amber-700",children:["I understand I will only receive $",ve.toFixed(2)," upfront from the receiver. I want to proceed with this amount."]})]})]})]})}),e.jsxs("div",{children:[e.jsx(W,{children:"Order Countdown Timer"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"How long receivers have to send payment details after accepting"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Fe.map(s=>e.jsxs(M,{type:"button",variant:h===s.value?"default":"outline",size:"sm",onClick:()=>u(s.value),"data-testid":`button-countdown-${s.value}`,children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),s.label]},s.value))})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"paymentMethods",children:"Receiver Payment Methods"}),e.jsx(I,{id:"paymentMethods",value:S,onChange:s=>y(s.target.value),placeholder:"e.g. PayPal, Bank Transfer, Mobile Money","data-testid":"input-payment-methods"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter payment methods separated by commas"})]}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Fee Structure:"})," Loader pays 3% fee, Receiver pays 2% fee on successful deals."]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[e.jsx("strong",{children:"Cancellation:"})," 5% penalty if either party manually cancels."]})]}),e.jsx("div",{className:"p-3 bg-amber-500/10 rounded-lg border border-amber-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Me,{className:"h-5 w-5 text-amber-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-amber-700",children:"Upfront Reserve Required"}),e.jsxs("p",{className:"text-xs text-amber-600",children:["You need to reserve ",e.jsx("strong",{children:"10% collateral"})," ($",be.toFixed(2),") + ",e.jsx("strong",{children:"3% fee"})," ($",ye.toFixed(2),") = ",e.jsxs("strong",{children:["$",G.toFixed(2)]})," total. Collateral is refunded on completion. Fee is kept on successful deals."]})]})]})}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Your Balance:"})," $",ce.toFixed(2)]}),l&&ce<G&&e.jsxs("p",{className:"text-xs text-destructive mt-1",children:["Insufficient balance. You need $",G.toFixed(2)," (10% collateral + 3% fee)."]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(M,{className:"flex-1",onClick:()=>i.mutate(),disabled:!Be||i.isPending,"data-testid":"button-post-ad",children:[i.isPending?e.jsx(K,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Post Ad"]}),e.jsx(M,{variant:"outline",onClick:()=>o("active"),"data-testid":"button-cancel-post",children:"Cancel"})]}),V&&V.filter(s=>s.isActive).length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Your Active Ads"}),V.filter(s=>s.isActive).map(s=>e.jsx(te,{className:"mb-2",children:e.jsxs(se,{className:"p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.assetType," - $",parseFloat(s.dealAmount).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Commitment: $",parseFloat(s.frozenCommitment).toFixed(2)]})]}),e.jsx(M,{variant:"destructive",size:"sm",onClick:()=>D.mutate(s.id),disabled:D.isPending,"data-testid":`button-cancel-ad-${s.id}`,children:e.jsx(De,{className:"h-4 w-4"})})]})},s.id))]})]})]})}),e.jsx(he,{value:"orders",className:"space-y-4",children:Z?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):E&&E.length>0?E.map(s=>e.jsx(te,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>t(`/loader-order/${s.id}`),"data-testid":`card-order-${s.id}`,children:e.jsxs(se,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-foreground",children:[s.role==="loader"?"Loading to":"Receiving from"," ",s.role==="loader"?s.receiverUsername:s.loaderUsername]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Deal: $",parseFloat(s.dealAmount).toLocaleString()]})]}),Ye(s.status)]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(ne,{className:"h-3 w-3"}),new Date(s.createdAt).toLocaleDateString(),e.jsx(X,{variant:"outline",className:"ml-auto",children:s.role==="loader"?"Loader":"Receiver"})]})]})},s.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Re,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders yet"}),e.jsx(M,{variant:"outline",className:"mt-4",onClick:()=>o("active"),"data-testid":"button-browse-ads",children:"Browse Active Ads"})]})})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[e.jsx(Se,{className:"h-16 w-16 text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground text-lg text-center",children:"Please sign in to access Loaders Zone"}),e.jsx(M,{className:"mt-4",onClick:()=>t("/auth"),"data-testid":"button-login",children:"Sign In"})]})}function ra(){const{t}=Ee(),[a,n]=ge(),[r,o]=v.useState("feed"),[l,m]=v.useState("buy"),[d]=v.useState("all"),[g,x]=v.useState(""),[N,h]=v.useState(!1),{data:u,isLoading:S}=$({queryKey:["offers",l==="buy"?"sell":"buy",d,g],queryFn:async()=>{const f=new URLSearchParams;return f.append("type",l==="buy"?"sell":"buy"),d&&d!=="all"&&f.append("paymentMethod",d),g&&f.append("search",g),(await fetch(`/api/marketplace/offers?${f}`)).json()},enabled:r==="p2p"}),{data:y}=$({queryKey:["notifications","unread"],queryFn:async()=>(await(await w("/api/notifications/unread/count")).json()).count||0,enabled:P()}),T=f=>{if(!P()){n("/auth");return}n(`/trade/${f.id}`)},L=f=>({mpesa:"M-PESA Kenya",bank_transfer:"Bank Transfer",equity_bank:"Equity Bank",paybill:"M-pesa Paybill"})[f.toLowerCase()]||f,q=f=>{if(!f||f.length===0)return"Account";const C=f[0];return C.includes("Binance")?"Binance":C.includes("OKX")?"OKX":C.includes("Bybit")?"Bybit":C.includes("MEXC")?"MEXC":C.includes("KuCoin")?"KuCoin":C.replace(" UID","").replace(" Address","")},R=()=>{switch(r){case"feed":return t("feed.title");case"p2p":return t("marketplace.title");case"loaders":return t("loaders.title");default:return t("nav.marketplace")}};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsxs("header",{className:"sticky top-0 z-50 bg-background border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 sm:px-4 py-3 gap-1 sm:gap-2",children:[e.jsx("button",{className:"p-1 flex-shrink-0","data-testid":"button-back",children:e.jsx(ht,{className:"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 text-foreground"})}),e.jsx("span",{className:"text-xs sm:text-sm md:text-base text-foreground font-semibold border-b-2 border-foreground pb-1 truncate min-w-0",children:R()}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(Ge,{}),e.jsx(O,{href:"/notifications",children:e.jsxs(M,{variant:"ghost",size:"icon",className:"relative","data-testid":"button-notifications",children:[e.jsx(xt,{className:"h-4 sm:h-5 w-4 sm:w-5 text-muted-foreground"}),y>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-4 w-4 bg-destructive text-destructive-foreground text-xs rounded-full flex items-center justify-center",children:y>9?"9+":y})]})})]})]}),e.jsx("div",{className:"px-2 sm:px-4 pb-3",children:e.jsxs("div",{className:"flex gap-1 sm:gap-2 overflow-x-auto pb-1",children:[e.jsxs("button",{onClick:()=>o("feed"),className:`flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 rounded-full text-xs sm:text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0 ${r==="feed"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:text-foreground"}`,"data-testid":"section-feed",children:[e.jsx(Mt,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4"}),t("feed.title")]}),e.jsxs("button",{onClick:()=>o("p2p"),className:`flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 rounded-full text-xs sm:text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0 ${r==="p2p"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:text-foreground"}`,"data-testid":"section-p2p",children:[e.jsx(we,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("marketplace.title")}),e.jsx("span",{className:"sm:hidden",children:"KYC"})]}),e.jsxs("button",{onClick:()=>o("loaders"),className:`flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 rounded-full text-xs sm:text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0 ${r==="loaders"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:text-foreground"}`,"data-testid":"section-loaders",children:[e.jsx(K,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("loaders.title")}),e.jsx("span",{className:"sm:hidden",children:t("loaders.shortTitle")})]})]})}),r==="p2p"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:t("common.search"),value:g,onChange:f=>x(f.target.value),className:"w-full pl-10 pr-4 py-2 bg-muted rounded-lg text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary","data-testid":"search-accounts"})]})}),e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"inline-flex bg-muted rounded-lg p-1",children:[e.jsx("button",{onClick:()=>m("buy"),className:`px-6 py-2 rounded-md text-sm font-medium transition-colors ${l==="buy"?"bg-foreground text-background":"text-muted-foreground hover:text-foreground"}`,"data-testid":"tab-buy",children:t("marketplace.buy")}),e.jsx("button",{onClick:()=>m("sell"),className:`px-6 py-2 rounded-md text-sm font-medium transition-colors ${l==="sell"?"bg-foreground text-background":"text-muted-foreground hover:text-foreground"}`,"data-testid":"tab-sell",children:t("marketplace.sell")})]})})]})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto pb-20",children:[r==="feed"&&e.jsx("div",{className:"p-4",children:e.jsx(ws,{})}),r==="p2p"&&e.jsx(e.Fragment,{children:S?e.jsx("div",{className:"p-4 space-y-4",children:[1,2,3,4].map(f=>e.jsx($e,{className:"h-40 bg-muted"},f))}):u&&u.length>0?(()=>{const C=ie()?.id;return e.jsx("div",{className:"divide-y divide-border",children:u.map(p=>{const Q=C&&p.vendorUserId===C;return e.jsxs("div",{className:`p-4 ${p.isPriority?"bg-amber-500/10 border-l-4 border-amber-400":"bg-background"}`,"data-testid":`offer-card-${p.id}`,children:[p.isPriority&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400 font-medium",children:"Promoted Ad"})}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("button",{onClick:()=>n(`/profile?id=${p.vendorUserId}`),className:"flex items-center gap-2 hover:opacity-80 transition-opacity","data-testid":`profile-link-vendor-${p.vendorUserId}`,children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:(p.vendorName||"V")[0].toUpperCase()}),e.jsx("span",{className:"font-medium text-foreground",children:p.vendorName||`Vendor_${p.vendorId.slice(0,6)}`})]}),p.vendorVerified&&e.jsx("div",{className:"w-4 h-4 bg-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-primary-foreground text-xs",children:"âœ“"})})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mb-3",children:[e.jsxs("span",{children:[p.vendorTrades??0," Trades"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ke,{className:"h-3 w-3"}),p.vendorRating??"99.00","%"]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-foreground",children:["$",Math.floor(parseFloat(p.pricePerUnit))]}),e.jsxs("span",{className:"text-muted-foreground text-xs",children:[" /",d!=="all"?d.replace(" UID","").replace(" Address",""):q(p.paymentMethods)," account"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:["Limit ",e.jsxs("span",{className:"text-foreground",children:["$",Math.floor(parseFloat(p.minLimit)).toLocaleString()," - $",Math.floor(parseFloat(p.maxLimit)).toLocaleString()]})]}),e.jsxs("p",{children:["Available ",e.jsxs("span",{className:"text-foreground",children:[Math.floor(parseFloat(p.availableAmount))," accounts"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("div",{className:"text-right space-y-1",children:p.paymentMethods.slice(0,4).map((_,U)=>e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:L(_)}),e.jsx("div",{className:"w-1.5 h-3 bg-primary rounded-sm"})]},U))}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-2",children:[e.jsx(ne,{className:"h-3 w-3"}),e.jsxs("span",{children:[p.responseTime||15," min"]})]}),Q?e.jsx(X,{className:"bg-muted text-muted-foreground px-4 py-2 mt-2",children:"Your Ad"}):e.jsx(M,{className:`${l==="buy"?"bg-primary hover:bg-primary/90":"bg-red-500 hover:bg-red-600"} text-primary-foreground px-8 py-2 rounded-md font-medium mt-2`,onClick:()=>T(p),"data-testid":`button-trade-${p.id}`,children:l==="buy"?"Buy":"Sell"})]})]})]},p.id)})})})():e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(vt,{className:"h-16 w-16 text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"No accounts found"}),e.jsx("p",{className:"text-muted-foreground/70 text-sm",children:"Try a different search or filter"})]})}),r==="loaders"&&e.jsx(ks,{})]}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-background border-t border-border z-50",children:e.jsxs("div",{className:"flex items-center justify-around py-2",children:[e.jsx(O,{href:"/",children:e.jsxs("button",{className:"flex flex-col items-center gap-1 px-4 py-2","data-testid":"nav-home",children:[e.jsx(ft,{className:`h-6 w-6 ${a==="/"?"text-foreground":"text-muted-foreground"}`}),e.jsx("span",{className:`text-xs ${a==="/"?"text-foreground":"text-muted-foreground"}`,children:t("navigation.home")})]})}),e.jsx(O,{href:"/orders",children:e.jsxs("button",{className:"flex flex-col items-center gap-1 px-4 py-2","data-testid":"nav-orders",children:[e.jsx(pt,{className:`h-6 w-6 ${a==="/orders"?"text-foreground":"text-muted-foreground"}`}),e.jsx("span",{className:`text-xs ${a==="/orders"?"text-foreground":"text-muted-foreground"}`,children:t("navigation.orders")})]})}),e.jsxs("button",{className:"flex flex-col items-center gap-1 px-4 py-2","data-testid":"nav-ads",onClick:()=>h(!0),children:[e.jsx(St,{className:"h-6 w-6 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("navigation.ads")})]}),e.jsx(O,{href:"/notifications",children:e.jsxs("button",{className:"flex flex-col items-center gap-1 px-4 py-2 relative","data-testid":"nav-chat",children:[e.jsx(H,{className:`h-6 w-6 ${a==="/notifications"?"text-foreground":"text-muted-foreground"}`}),y>0&&e.jsx("span",{className:"absolute top-1 right-2 h-4 w-4 bg-destructive text-destructive-foreground text-xs rounded-full flex items-center justify-center",children:y>9?"9+":y}),e.jsx("span",{className:`text-xs ${a==="/notifications"?"text-foreground":"text-muted-foreground"}`,children:t("navigation.chat")})]})}),e.jsx(O,{href:"/settings",children:e.jsxs("button",{className:"flex flex-col items-center gap-1 px-4 py-2","data-testid":"nav-profile",children:[e.jsx(Re,{className:`h-6 w-6 ${a==="/settings"?"text-foreground":"text-muted-foreground"}`}),e.jsx("span",{className:`text-xs ${a==="/settings"?"text-foreground":"text-muted-foreground"}`,children:t("navigation.profile")})]})})]})}),e.jsx(Le,{open:N,onOpenChange:h,children:e.jsxs(qe,{className:"sm:max-w-md",children:[e.jsx(_e,{children:e.jsx(Ue,{children:t("vendor.chooseAdType")})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("button",{onClick:()=>{h(!1),n("/vendor")},className:"flex items-center gap-4 p-4 rounded-lg border border-border hover:bg-muted transition-colors","data-testid":"btn-kyc-ad",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(we,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-foreground",children:t("vendor.kycMarketplaceAd")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("vendor.postAdBuyOrSell")})]})]}),e.jsxs("button",{onClick:()=>{h(!1),o("loaders")},className:"flex items-center gap-4 p-4 rounded-lg border border-border hover:bg-muted transition-colors","data-testid":"btn-loader-ad",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-500/10 flex items-center justify-center",children:e.jsx(Ie,{className:"h-6 w-6 text-amber-500"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-foreground",children:t("vendor.loadersZoneAd")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("vendor.postAdLoadingServices")})]})]})]})]})}),e.jsx(O,{href:"/support",children:e.jsx("button",{className:"fixed bottom-6 right-6 w-14 h-14 rounded-full bg-primary hover:bg-primary/90 shadow-lg flex items-center justify-center text-white z-40 transition-all hover:scale-110","data-testid":"button-floating-support",title:"Report Issue or Contact Support",children:e.jsx(gt,{className:"h-6 w-6"})})})]})}export{ra as default};
