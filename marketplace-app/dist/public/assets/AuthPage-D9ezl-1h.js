import{c as Q,b as X,d as Z,r as i,j as e}from"./index-B6hPo9fH.js";import{u}from"./useMutation-C_3TpXjp.js";import{C as ee,b as te,c as se,d as re,a as ae}from"./card-Cl1MO1GN.js";import{B as o}from"./button-DdYfvWb9.js";import{I as l}from"./input-vnQcFn7U.js";import{L as n}from"./label-B38SsxLd.js";import{T as oe,a as ie,b as W,c as K}from"./tabs-YN5y1_yR.js";import{u as ne}from"./useTranslation-O3_Fa0eH.js";import{S as de}from"./shield-DVigj7cn.js";import{L as D}from"./lock-67rVn5Zl.js";import{U as le}from"./index-Dt-oTuiC.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],I=Q("mail",ce);function Se(){const{t:ue}=ne(),[,M]=X(),{toast:a}=Z(),[d,N]=i.useState({emailOrUsername:"",password:"",twoFactorToken:""}),[c,v]=i.useState({username:"",email:"",password:""}),[S,_]=i.useState(""),[C,p]=i.useState("email"),[z,G]=i.useState(!1),[H,m]=i.useState(!1),[F,g]=i.useState("username"),[k,f]=i.useState(""),[P,x]=i.useState(""),[E,h]=i.useState(""),[B,b]=i.useState(""),[$,j]=i.useState(!1),[J,w]=i.useState("email"),[O,T]=i.useState(""),[me,Y]=i.useState(d.emailOrUsername),A=u({mutationFn:async t=>{const s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await s.json();if(!s.ok)throw new Error(r.message);return r},onSuccess:t=>{if(t.requiresTwoFactor){G(!0),a({title:"2FA Required",description:"Please enter your authenticator code"});return}localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user)),a({title:"Welcome back!",description:`Logged in as ${t.user.username}`}),M("/")},onError:t=>{a({variant:"destructive",title:"Login Failed",description:t.message})}}),L=u({mutationFn:async t=>{const s=await fetch("/api/auth/send-verification-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}),r=await s.json();if(!s.ok)throw new Error(r.message);return r},onSuccess:()=>{a({title:"Code Sent",description:"Check your email for the verification code"}),p("verify")},onError:t=>{a({variant:"destructive",title:"Failed",description:t.message})}}),R=u({mutationFn:async t=>{const s=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await s.json();if(!s.ok)throw new Error(r.message);return r},onSuccess:t=>{localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user)),a({title:"Account Created!",description:"Welcome to KYC Marketplace"}),M("/")},onError:t=>{a({variant:"destructive",title:"Registration Failed",description:t.message})}}),y=u({mutationFn:async t=>{const s=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emailOrUsername:t})}),r=await s.json();if(!s.ok)throw new Error(r.message);return r},onSuccess:(t,s)=>{x(s),a({title:"Code Sent",description:"Check your email for the password reset code"}),g("code")},onError:t=>{a({variant:"destructive",title:"Failed",description:t.message})}}),U=u({mutationFn:async t=>{const s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await s.json();if(!s.ok)throw new Error(r.message);return r},onSuccess:()=>{a({title:"Password Reset",description:"Your password has been reset successfully"}),m(!1),g("username"),f(""),x(""),h(""),b("")},onError:t=>{a({variant:"destructive",title:"Reset Failed",description:t.message})}}),V=u({mutationFn:async t=>{const s=await fetch("/api/auth/reset-2fa-lost",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await s.json();if(!s.ok)throw new Error(r.message);return r},onSuccess:t=>{t.requiresVerification?(a({title:"Code Sent",description:"Enter the verification code from your email"}),w("emailVerify")):(a({title:"2FA Reset",description:"Your 2FA has been reset successfully"}),j(!1),w("email"),T(""),Y(""))},onError:t=>{a({variant:"destructive",title:"Failed",description:t.message})}}),q=u({mutationFn:async t=>{const s=await fetch("/api/auth/verify-2fa-reset-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await s.json();if(!s.ok)throw new Error(r.message);return r},onSuccess:()=>{a({title:"2FA Reset",description:"Your 2FA has been reset successfully"}),j(!1),w("email"),T(""),Y("")},onError:t=>{a({variant:"destructive",title:"Failed",description:t.message})}});return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-3 sm:p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-3 bg-primary rounded-xl",children:e.jsx(de,{className:"h-7 sm:h-8 w-7 sm:w-8 text-primary-foreground"})})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground truncate",children:"KYC Marketplace"}),e.jsx("p",{className:"text-muted-foreground text-sm sm:text-base mt-2",children:"Secure peer-to-peer trading"})]}),e.jsxs(ee,{className:"border-border bg-card/50 backdrop-blur",children:[e.jsxs(te,{children:[e.jsx(se,{className:"text-foreground",children:"Get Started"}),e.jsx(re,{children:"Sign in or create an account to start trading"})]}),e.jsx(ae,{children:e.jsxs(oe,{defaultValue:"login",children:[e.jsxs(ie,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(W,{value:"login","data-testid":"tab-login",children:"Login"}),e.jsx(W,{value:"register","data-testid":"tab-register",children:"Register"})]}),e.jsx(K,{value:"login",children:$?e.jsxs(e.Fragment,{children:[J==="email"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),V.mutate({emailOrUsername:d.emailOrUsername})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-foreground",children:"Confirm Identity"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We'll send a verification code to your email"}),e.jsx(l,{value:d.emailOrUsername,disabled:!0,className:"bg-muted border-border text-foreground opacity-70"})]}),e.jsx(o,{type:"submit",className:"w-full",disabled:V.isPending,"data-testid":"button-send-2fa-reset",children:V.isPending?"Sending...":"Send Verification Code"}),e.jsx(o,{type:"button",variant:"outline",className:"w-full",onClick:()=>j(!1),children:"Back"})]}),J==="emailVerify"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),q.mutate({emailOrUsername:d.emailOrUsername,code:O})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-foreground",children:"Verification Code"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the 6-digit code from your email"}),e.jsx(l,{placeholder:"Enter 6-digit code",value:O,onChange:t=>T(t.target.value.replace(/\D/g,"").slice(0,6)),className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,"data-testid":"input-2fa-verify-code"})]}),e.jsx(o,{type:"submit",className:"w-full",disabled:O.length!==6||q.isPending,"data-testid":"button-verify-2fa-code",children:q.isPending?"Verifying...":"Verify Code"}),e.jsx(o,{type:"button",variant:"outline",className:"w-full",onClick:()=>w("email"),children:"Back"})]})]}):H?e.jsxs(e.Fragment,{children:[F==="username"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),y.mutate(k)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"forgot-email",className:"text-foreground",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(l,{id:"forgot-email","data-testid":"input-forgot-email",placeholder:"Your email",type:"email",className:"pl-10 bg-muted border-border text-foreground opacity-70 cursor-not-allowed",value:k,disabled:!0,required:!0})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reset password for this account"})]}),e.jsx(o,{type:"submit","data-testid":"button-send-reset-code",className:"w-full",disabled:y.isPending||!k,children:y.isPending?"Sending...":"Send Reset Code"}),e.jsx(o,{type:"button",variant:"outline",className:"w-full",onClick:()=>m(!1),disabled:y.isPending,children:"Back to Login"})]}),F==="code"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),g("reset")},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-foreground",children:"Account Confirmed"}),e.jsxs("div",{className:"bg-muted border border-border rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-sm text-foreground font-medium",children:P}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Password reset code sent to this account's registered email"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-foreground",children:"Reset Code"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Enter the 6-digit code from your email"}),e.jsx(l,{"data-testid":"input-forgot-code",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:E,onChange:t=>h(t.target.value.replace(/\D/g,"").slice(0,6)),required:!0})]}),e.jsx(o,{type:"submit","data-testid":"button-verify-reset-code",className:"w-full",disabled:E.length!==6,children:"Continue"}),e.jsx(o,{type:"button",variant:"outline",className:"w-full",onClick:()=>{m(!1),g("username"),f(""),x(""),h(""),b("")},children:"Back to Login"})]}),F==="reset"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),U.mutate({emailOrUsername:P,code:E,newPassword:B})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-foreground",children:"Account"}),e.jsx("div",{className:"bg-muted border border-border rounded-lg p-3 mb-3",children:e.jsx("p",{className:"text-sm text-foreground font-medium",children:P})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"new-password",className:"text-foreground",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(l,{id:"new-password","data-testid":"input-new-password",type:"password",placeholder:"Enter new password",className:"pl-10 bg-muted border-border text-foreground",value:B,onChange:t=>b(t.target.value),required:!0})]})]}),e.jsx(o,{type:"submit","data-testid":"button-reset-password",className:"w-full",disabled:U.isPending,children:U.isPending?"Resetting...":"Reset Password"}),e.jsx(o,{type:"button",variant:"outline",className:"w-full",onClick:()=>{m(!1),g("username"),f(""),x(""),h(""),b("")},children:"Back to Login"})]})]}):e.jsxs("form",{onSubmit:t=>{t.preventDefault(),A.mutate(d)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"login-email",className:"text-foreground",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(l,{id:"login-email","data-testid":"input-login-email",placeholder:"Enter your email",type:"email",className:"pl-10 bg-muted border-border text-foreground",value:d.emailOrUsername,onChange:t=>N({...d,emailOrUsername:t.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"login-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(l,{id:"login-password","data-testid":"input-login-password",type:"password",placeholder:"Enter password",className:"pl-10 bg-muted border-border text-foreground",value:d.password,onChange:t=>N({...d,password:t.target.value})})]}),e.jsx("button",{type:"button","data-testid":"button-forgot-password",className:"text-xs text-primary hover:underline",onClick:()=>{m(!0),f(d.emailOrUsername)},children:"Forgot Password?"})]}),z&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"2fa-token",className:"text-foreground",children:"2FA Code"}),e.jsx(l,{id:"2fa-token","data-testid":"input-2fa-token",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:d.twoFactorToken,onChange:t=>N({...d,twoFactorToken:t.target.value})}),e.jsx("button",{type:"button","data-testid":"button-reset-authenticator",className:"text-xs text-primary hover:underline",onClick:()=>j(!0),children:"Reset Authenticator?"})]}),e.jsx(o,{type:"submit","data-testid":"button-login",className:"w-full",disabled:A.isPending,children:A.isPending?"Signing in...":"Sign In"})]})}),e.jsxs(K,{value:"register",children:[C==="email"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),L.mutate(c.email)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"register-email",className:"text-foreground",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(l,{id:"register-email","data-testid":"input-register-email",type:"email",placeholder:"Enter your email",className:"pl-10 bg-muted border-border text-foreground",value:c.email,onChange:t=>v({...c,email:t.target.value}),required:!0})]})]}),e.jsx(o,{type:"submit","data-testid":"button-send-code",className:"w-full",disabled:L.isPending,children:L.isPending?"Sending...":"Send Verification Code"})]}),C==="verify"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),p("create")},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"text-foreground",children:"Verification Code"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the code sent to ",c.email]}),e.jsx("div",{className:"relative",children:e.jsx(l,{"data-testid":"input-verification-code",placeholder:"Enter 6-digit code",className:"bg-muted border-border text-foreground text-center text-lg tracking-widest",maxLength:6,value:S,onChange:t=>_(t.target.value.replace(/\D/g,"").slice(0,6)),required:!0})})]}),e.jsx(o,{type:"submit","data-testid":"button-verify-code",className:"w-full",disabled:S.length!==6,children:"Continue"}),e.jsx(o,{type:"button",variant:"outline",className:"w-full",onClick:()=>p("email"),children:"Back"})]}),C==="create"&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),R.mutate({...c,verificationCode:S})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"register-username",className:"text-foreground",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(l,{id:"register-username","data-testid":"input-register-username",placeholder:"Choose username",className:"pl-10 bg-muted border-border text-foreground",value:c.username,onChange:t=>v({...c,username:t.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"register-password",className:"text-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(l,{id:"register-password","data-testid":"input-register-password",type:"password",placeholder:"Create password",className:"pl-10 bg-muted border-border text-foreground",value:c.password,onChange:t=>v({...c,password:t.target.value}),required:!0})]})]}),e.jsx(o,{type:"submit","data-testid":"button-register",className:"w-full",disabled:R.isPending,children:R.isPending?"Creating account...":"Create Account"}),e.jsx(o,{type:"button",variant:"outline",className:"w-full",onClick:()=>p("verify"),children:"Back"})]})]})]})})]})]})})}export{Se as default};
