import{c as I,l as O,b as P,d as M,r as f,a as T,j as e,S as j,g as B,f as U}from"./index-B6hPo9fH.js";import{u as $}from"./useMutation-C_3TpXjp.js";import{L as c}from"./Layout-BTVfT1Q4.js";import{C as N,b,c as w,a as v}from"./card-Cl1MO1GN.js";import{B as F}from"./button-DdYfvWb9.js";import{I as C}from"./input-vnQcFn7U.js";import{L as x}from"./label-B38SsxLd.js";import{B as _}from"./badge-Dn4EaI7W.js";import{u as E}from"./useTranslation-O3_Fa0eH.js";import{C as p}from"./circle-alert-LzkFmbap.js";import{S as V}from"./star-CUTTDGaz.js";import{C as R}from"./circle-check-big-BkJjytOF.js";import{S as W}from"./shield-DVigj7cn.js";import"./ThemeToggle-Cd9vwdUm.js";import"./index-Dt-oTuiC.js";import"./shopping-cart-DT7LSJeM.js";import"./triangle-alert-DGpOeCBb.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],D=I("arrow-left-right",q);function oe(){const{t:Y}=E(),[,A]=O("/trade/:id"),[,h]=P(),n=A?.id,{toast:u}=M(),[i,o]=f.useState(""),[d,l]=f.useState(""),{data:t,isLoading:L}=T({queryKey:["offer",n],queryFn:async()=>(await(await fetch("/api/marketplace/offers")).json()).find(r=>r.id===n),enabled:!!n}),m=$({mutationFn:async()=>{const s={offerId:n,amount:i,fiatAmount:d,paymentMethod:t?.paymentMethods[0]||"Platform Wallet"};t?.tradeIntent==="buy_ad"&&(s.buyerId=t.vendorUserId);const a=await U("/api/orders",{method:"POST",body:JSON.stringify(s)}),r=await a.json();if(!a.ok)throw new Error(r.message);return r},onSuccess:s=>{const a=t?.tradeIntent==="buy_ad";u({title:"Order created!",description:a?"Waiting for buyer to deposit funds":"Proceed with the transaction"}),h(`/order/${s.id}`)},onError:s=>{u({variant:"destructive",title:"Failed to create order",description:s.message})}}),k=s=>{if(s===""){o(""),l("");return}if(!/^\d+(\.\d{0,8})?$/.test(s))return;const a=parseFloat(s);if(o(a>0?s:""),t&&a>0){const r=a*parseFloat(t.pricePerUnit);l(String(r.toFixed(2)))}else l("")},S=s=>{if(s===""){l(""),o("");return}/^\d+(\.\d{0,8})?$/.test(s)&&l(s)};if(L)return e.jsx(c,{children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsx(j,{className:"h-64 bg-gray-800"}),e.jsx(j,{className:"h-96 bg-gray-800"})]})});if(!t)return e.jsx(c,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"h-12 w-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Offer not found"})]})});const g=B();if(g&&t.vendorUserId===g.id)return e.jsx(c,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"h-12 w-12 text-amber-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"This is your own ad"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"You cannot trade on your own advertisement"}),e.jsx(F,{className:"mt-4",onClick:()=>h("/"),"data-testid":"button-back-home",children:"Back to Marketplace"})]})});const y=i&&parseFloat(d)>=parseFloat(t.minLimit)&&parseFloat(d)<=parseFloat(t.maxLimit)&&parseFloat(i)<=parseFloat(t.availableAmount);return e.jsx(c,{children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 sm:space-y-6 px-2 sm:px-4",children:[e.jsxs(N,{className:"bg-gray-900/50 border-gray-800",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(w,{className:"text-white flex items-center gap-2 truncate min-w-0",children:[e.jsx(D,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[t.type==="buy"?"Sell":"Buy"," ",t.currency]})]}),e.jsxs(_,{className:t.type==="buy"?"bg-green-600":"bg-red-600",children:[t.type.toUpperCase()," Offer"]})]})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-purple-600 flex items-center justify-center",children:e.jsx(V,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Verified Vendor"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(R,{className:"h-3 w-3 text-green-400"}),e.jsx("span",{children:"KYC Verified"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Price per account"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",Math.floor(parseFloat(t.pricePerUnit))]})]}),e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Available"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[Math.floor(parseFloat(t.availableAmount))," accounts"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Limits"}),e.jsxs("p",{className:"text-white",children:["$",parseFloat(t.minLimit).toFixed(0)," - $",parseFloat(t.maxLimit).toFixed(0)]})]}),t.terms&&e.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Terms"}),e.jsx("p",{className:"text-gray-300 text-sm",children:t.terms})]})]})]}),e.jsxs(N,{className:"bg-gray-900/50 border-gray-800",children:[e.jsx(b,{children:e.jsx(w,{className:"text-white",children:"Create Order"})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-gray-300",children:"Number of accounts"}),e.jsx(C,{type:"number",placeholder:"1",min:"1",step:"1",className:"bg-gray-800 border-gray-700 text-white text-lg",value:i,onChange:s=>k(s.target.value),"data-testid":"input-account-amount"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-gray-300",children:"Total price (USD)"}),e.jsx(C,{type:"number",placeholder:"0",className:"bg-gray-800 border-gray-700 text-white text-lg",value:d,onChange:s=>S(s.target.value),"data-testid":"input-fiat-amount",readOnly:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-gray-300",children:"Account Type"}),e.jsxs("div",{className:"p-3 bg-gray-800 rounded-lg",children:[e.jsxs("span",{className:"text-white font-medium",children:[t.paymentMethods[0]?.replace(" UID","").replace(" Address","")||"Platform"," Account"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Payment via Platform Wallet"})]})]}),e.jsxs("div",{className:"p-4 bg-purple-900/30 border border-purple-700 rounded-lg flex items-start gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-purple-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-300 font-medium",children:"Escrow Protection"}),e.jsx("p",{className:"text-purple-400 text-sm",children:t.tradeIntent==="sell_ad"?"Your funds will be held in escrow immediately. Seller delivers, then you confirm to release payment.":"After seller accepts, you'll need to deposit funds. Once escrowed, seller delivers and you confirm."})]})]}),t.tradeIntent==="buy_ad"&&e.jsxs("div",{className:"p-4 bg-yellow-900/30 border border-yellow-700 rounded-lg flex items-start gap-3",children:[e.jsx(p,{className:"h-5 w-5 text-yellow-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-300 font-medium",children:"This is a Buy Request"}),e.jsx("p",{className:"text-yellow-400 text-sm",children:"The buyer is looking for sellers. If you accept, you'll deliver the product after the buyer deposits funds."})]})]}),e.jsx(F,{className:"w-full bg-purple-600 hover:bg-purple-700 h-12 text-lg",disabled:!y||m.isPending,onClick:()=>m.mutate(),"data-testid":"button-create-order",children:m.isPending?"Creating Order...":"Create Order"}),i&&!y&&e.jsxs("p",{className:"text-red-400 text-sm text-center",children:["Amount must be within limits ($",parseFloat(t.minLimit).toFixed(0)," - $",parseFloat(t.maxLimit).toFixed(0),")"]})]})]})]})})}export{oe as default};
